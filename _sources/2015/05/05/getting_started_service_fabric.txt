Getting Started - Service Fabric
================================



以下のセクションは、 `Set up your Service Fabric development environment <http://azure.microsoft.com/en-us/documentation/articles/service-fabric-get-started/>_` を元にしています。

Setup SDK
=========


サポートされるOS
* Windows 8/8.1
* Windows Server 2012 R2
* Windows 10 Technical Preview

Visual Studio 2015
* Service Fabric Preview 1 は、Visual Studio 2015 RC が必要

Service Fabric のコンポーネントをWeb Platform Installerを使ってインストールします。 `MicrosoftAzure-ServiceFabric <http://www.microsoft.com/web/handlers/webpi.ashx?command=getinstallerredirect&appid=MicrosoftAzure-ServiceFabric>`_

image: sdkinstall.png

Service Fabric では、VSからのデプロイとローカルの開発用Clusterの作成のためにWindows PowerShell スクリプト使います。Windowsのデフォルトでは、スクリプトがブロックされるので、PowerShell の execution policy を変更します。

> Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Force -Scope CurrentUser


PowerShell のコンソールを administrator で開いて下記ように実行します。実行には数分かかります。

$ cd "$env:ProgramFiles\Microsoft SDKs\Service Fabric\ClusterSetup"
$ ls


    ディレクトリ: C:\Program Files\Microsoft SDKs\Service Fabric\ClusterSetup


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----       2015/05/05     13:13                NonSecure
d-----       2015/05/05     13:13                Secure
-a----       2015/04/23     18:47           1673 CleanCluster.ps1
-a----       2015/04/23     18:47           7462 DevClusterSetup.ps1

$ ./DevClusterSetup.ps1

Cleaning existing cluster ...

  NOTE: If this powershell command window exits, please re-run the script in a new powershell command window.


Stopping service FabricHostSvc. This may take a few minutes...
Removing cluster configuration
Remove node configuration succeeded
Cleaning existing certificates
Stopping all logman sessions
Cleaning log and data folder, the powershell window may close automatically.
ClusterPath not provided, will use C:\SfDevCluster
FabricDataRoot not provided, will use C:\SfDevCluster\Data
FabricLogRoot not provided, will use C:\SfDevCluster\Log


    ディレクトリ: C:\


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----       2015/05/05     13:18                SfDevCluster


    ディレクトリ: C:\SfDevCluster


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----       2015/05/05     13:18                Manifests
True
Create node configuration succeeded
Starting service FabricHostSvc. This may take a few minutes...
Connecting to Service Fabric Cluster. This may take a few minutes. Please ignore the initial warnings...
Connect-ServiceFabricCluster 'localhost:19000'
True
True

FabricClientSettings : {
                       ClientFriendlyName                   : PowerShell-d7561a85-e422-4d96-80f
                       4-ef4e97168e2a
                       PartitionLocationCacheLimit          : 100000
                       PartitionLocationCacheBucketCount    : 1024
                       ServiceChangePollInterval            : 00:02:00
                       ConnectionInitializationTimeout      : 00:00:02
                       KeepAliveInterval                    : 00:00:20
                       HealthOperationTimeout               : 00:02:00
                       HealthReportSendInterval             : 00:00:00
                       HealthReportRetrySendInterval        : 00:00:30
                       NotificationGatewayConnectionTimeout : 00:00:00
                       NotificationCacheUpdateTimeout       : 00:00:00
                       }
GatewayInformation   : {
                       NodeAddress                          : localhost:19000
                       NodeId                               : 1880ec88a3187766a6da323399721f53
                       NodeInstanceId                       : 130752731351796750
                       NodeName                             : Node.1
                       }
FabricClient         : System.Fabric.FabricClient
ConnectionEndpoint   : {localhost:19000}
SecurityCredentials  :

Connected with Service Fabric Cluster

NodeDeactivationInfo :
NodeName             : Node.4
IpAddressOrFQDN      : localhost
NodeType             : NodeType4
CodeVersion          : 4.0.95.9490
ConfigVersion        : 1.0
NodeStatus           : Up
NodeUpTime           : 00:00:33
HealthState          : Unknown
IsSeedNode           : False
UpgradeDomain        : UD4
FaultDomain          : fd:/FD04
NodeId               : 182043d0294b3f36e954e0397268b770
NodeInstanceId       : 130752731342886765


NodeDeactivationInfo :
NodeName             : Node.2
IpAddressOrFQDN      : localhost
NodeType             : NodeType2
CodeVersion          : 4.0.95.9490
ConfigVersion        : 1.0
NodeStatus           : Up
NodeUpTime           : 00:00:33
HealthState          : Unknown
IsSeedNode           : True
UpgradeDomain        : UD2
FaultDomain          : fd:/FD02
NodeId               : 1840a58b116c5f9c7a0b1837194c4205
NodeInstanceId       : 130752731348016763


NodeDeactivationInfo :
NodeName             : Node.1
IpAddressOrFQDN      : localhost
NodeType             : NodeType1
CodeVersion          : 4.0.95.9490
ConfigVersion        : 1.0
NodeStatus           : Up
NodeUpTime           : 00:00:33
HealthState          : Unknown
IsSeedNode           : True
UpgradeDomain        : UD1
FaultDomain          : fd:/FD01
NodeId               : 1880ec88a3187766a6da323399721f53
NodeInstanceId       : 130752731351796750


NodeDeactivationInfo :
NodeName             : Node.5
IpAddressOrFQDN      : localhost
NodeType             : NodeType5
CodeVersion          : 4.0.95.9490
ConfigVersion        : 1.0
NodeStatus           : Up
NodeUpTime           : 00:00:33
HealthState          : Unknown
IsSeedNode           : False
UpgradeDomain        : UD5
FaultDomain          : fd:/FD05
NodeId               : 18a05673ad5b226e2826584627c00a22
NodeInstanceId       : 130752731342746765


NodeDeactivationInfo :
NodeName             : Node.3
IpAddressOrFQDN      : localhost
NodeType             : NodeType3
CodeVersion          : 4.0.95.9490
ConfigVersion        : 1.0
NodeStatus           : Up
NodeUpTime           : 00:00:33
HealthState          : Unknown
IsSeedNode           : True
UpgradeDomain        : UD3
FaultDomain          : fd:/FD03
NodeId               : 18c04a60c5c8e287f4f4337ba8642205
NodeInstanceId       : 130752731346896749




NodeDeactivationInfo NodeName IpAddressOrFQDN NodeType  CodeVersion ConfigVersion NodeStatus NodeUpTime
-------------------- -------- --------------- --------  ----------- ------------- ---------- ----------
                     Node.4   localhost       NodeType4 4.0.95.9490 1.0                   Up 00
                     Node.2   localhost       NodeType2 4.0.95.9490 1.0                   Up 00
                     Node.1   localhost       NodeType1 4.0.95.9490 1.0                   Up 00
                     Node.5   localhost       NodeType5 4.0.95.9490 1.0                   Up 00
                     Node.3   localhost       NodeType3 4.0.95.9490 1.0                   Up 00



NodeName FaultDomain UpgradeDomain NodeStatus HealthState
-------- ----------- ------------- ---------- -----------
Node.4   fd:/FD04    UD4                   Up     Unknown
Node.2   fd:/FD02    UD2                   Up     Unknown
Node.1   fd:/FD01    UD1                   Up     Unknown
Node.5   fd:/FD05    UD5                   Up     Unknown
Node.3   fd:/FD03    UD3                   Up     Unknown


Cluster created successfully
警告: CLOSE this powershell Window.
To connect using Powershell, open an a new powershell window and connect using 'Connect-ServiceFabricCluster' command (without any arguments).
To connect using ServiceFabricExplorer, run ServiceFabricExplorer and connect using 'Local/OneBox Cluster'.
$

インストールが終わったら、一旦サインアウトしてログインし直します。

確認
====
インストールが上手く行っているか、SDKのService Fabric Explorer で確認します。

1. %programfiles%\Microsoft SDKs\Service Fabric\Tools\ServiceFabricExplorer の ServiceFabricExplorer.exe を起動
2. Service Fabric Explorer の左上の Onebox/Local Cluster のノードを開きます
3. Application と Node views がグリーンになっているのを確認します

ここで上手く行かない場合は、 `ローカル開発クラスタ設定 のトラブルシューティング <http://azure.microsoft.com/en-us/documentation/articles/service-fabric-troubleshoot-local-cluster-setup/>`_  を参考にしてください。

image: clustersetup.png


メモ
====
ローカル cluster は Azure上と完全に同じランタイムを使っていて、シミュレーターやエミュレータではない。Azure上の環境と違うのはシングルマシンで動いてるところだけ、Azureでは複数のマシンに分散配置される。


ここからは、`Choosing a framework for your service <http://azure.microsoft.com/en-us/documentation/articles/service-fabric-choose-framework/>`_ に移ります。

フレームワークの選択
====================
Service Fabric では、サービス構築のために、Reliable Actors APIs と Reliable Services API の２つの high-level frameworks が提供されています。 ２つは同じ Service Fabric コアの上に構築され,、concurrency, partitioning, and communication での単純の柔軟性のトレードオフがあります。あなたのアプリケーションの固有の特性に合わせて、サービスの適切なフレームワークを選択することができるように、両方のモデルを理解しておくといいでしょう。

RELIABLE ACTORS APIS,RELIABLE SERVICES APIS
問題空間が独立の小さな部品に分解できる,複数コンポーネント間のロジックを維持する必要がある
スケールと一貫性を維持できる間は、single-threaded objects として扱いたい,状態の管理はreliable collections を使って自分で行う
並列性と状態の粒度は、フレームワークで管理して欲しい,状態の粒度と並列性の管理は自分でコントロールしたい
プラットフォームが通信を管理して欲しい, 通信の管理、パーティショニングスキマーの制御は自分でしたい

あなたのアプリケーションの中で、ことなったフレームワークを使うことには合理的な理由があることに注意してください。たとえば、多くのactor が生成したデータを集約するような statefull service などのような例です。

.. author:: default
.. categories:: none
.. tags:: none
.. comments::
