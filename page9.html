<!DOCTYPE html><!--[if lt IE 7]>      <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="もろもろの備忘録、C#とAzureなど">
        <meta name="viewport" content="width=device-width">
        <title>Page 9 &mdash; Kyrt Blog</title>
            <link rel="stylesheet" href="_static/normalize.css" type="text/css">
            <link rel="stylesheet" href="_static/sphinx.css" type="text/css">
            <link rel="stylesheet" href="_static/main.css" type="text/css">
            <link rel="stylesheet" href="_static/flat.css" type="text/css">
            <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
            <link rel="stylesheet" href="_static/font-awesome.min.css" type="text/css">
        <link rel="stylesheet" href="_static/style.css" type="text/css" /><link rel="shortcut icon" href="_static/favicon.ico" /><!-- Load modernizr and JQuery -->
        <script src="_static/vendor/modernizr-2.6.2.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="_static/vendor/jquery-1.8.2.min.js"><\/script>')</script>
        <script src="_static/plugins.js"></script>
        <script src="_static/main.js"></script>
        <link rel="search" title="Search" href="search.html" /><link rel="next" title="Older" href="page10.html" /><link rel="prev" title="Newer" href="page8.html" /><link rel="alternate" type="application/rss+xml" title="RSS" href="rss.html" /><script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.7.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        SOURCELINK_SUFFIX: '.txt',
        HAS_SOURCE:  true
      };
    </script><script type="text/javascript" src="_static/underscore.js"></script><script type="text/javascript" src="_static/doctools.js"></script><script type="text/javascript" src="_static/disqus.js"></script><script type="text/javascript" src="_static/google_analytics.js"></script><meta property="og:type" content="article" />
<meta property="og:title" content="Page 9 &mdash; Kyrt Blog" />
<meta property="og:description" content="もろもろの備忘録、C#とAzureなど" />
<meta property="og:url" content="http://kyrt.in/page9.html" />
<meta name="twitter:image" content="http://kyrt.in/_static/kyrt_logo4sq.png" />

</head>
    <body role="document">
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

      <div id="container"><header role="banner">
            <hgroup>
              <h1><a href="index.html">Kyrt Blog</a></h1><h2>もろもろの備忘録、C#とAzureなど</h2></hgroup>
          </header>
      <nav>
      <ul>
        <li class="main-nav">
          <a href="index.html">Home</a>
        </li>
        <li class="main-nav">
          <a href="pages/about_me.html">About Kyrt.</a>
        </li>
        </ul>
      <ul>
        <li class="logo-nav">
	  <a href="pages/about_me.html" >
            <img id="kyrt_logo" alt="kyrt logo" src="_static/kyrt_logo.png" width = 200 height = 106 />
	  </a>
        </li>
        <li class="mvp-nav">
	  <a href="https://mvp.microsoft.com/en-us/PublicProfile/5000998?fullName=Takekazu%20%20Omi" >
            <img id="mvp_logo" alt="mvp logo" src="_static/MVP_Reconnect_Logo_Blue_Color_RGB.png" width = 181 height = 74 />
	  </a>
        </li><li class="quicklink"><div class="rss">
        <a href="rss.html" title="Subscribe via RSS"><span class="fa fa-lg fa-rss"></span></a>
    </div></li></ul>
    </nav><div class="main-container" role="main"><div class="main wrapper body clearfix"><article><div class="timestamp postmeta">
            <span>December 27, 2013</span>
        </div>
        <div class="section">
            <h1><a href="2013/12/27/azure_storage_known_issues_november_2013_resolved.html">[Resolved] Windows Azure Storage Known Issues 2013/11</a></h1>
<p><a class="reference internal" href="2013/11/24/windows_azure_storage_known_issues_2013_11.html"><span class="doc">Windows Azure Storage Known Issues 2013/11</span></a>の既知の問題が解決されたとアナウンスがありました。<a class="reference external" href="http://blogs.msdn.com/b/windowsazurestorage/archive/2013/11/23/windows-azure-storage-known-issues-november-2013.aspx">Windows Azure Storage Known Issues (November 2013) [Resolved]</a>どんな感じになったのかを確認しました。</p>
<div class="section" id="id1">
<h2>引用</h2>
<blockquote>
<div><div class="line-block">
<div class="line">更新 [2013/12/10] : <a class="reference external" href="http://blogs.msdn.com/b/windowsazurestorage/archive/2013/11/23/windows-azure-storage-known-issues-november-2013.aspx">このBlog に記述されている問題</a> <a class="footnote-reference" href="#r1" id="id2">[1]</a> は、service と client library の更新で解決されました。issue 2 の client table の件は、 <a class="reference external" href="https://www.nuget.org/packages/WindowsAzure.Storage/2.1.0.4">2.1.0.4</a>  <a class="footnote-reference" href="#r2" id="id4">[2]</a> と  <a class="reference external" href="https://www.nuget.org/packages/WindowsAzure.Storage">3.x</a> <a class="footnote-reference" href="#r3" id="id5">[3]</a> の client library の releases で解決されています。</div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br/></div>
</div>
<a class="reference external image-reference" href="http://www.flickr.com/photos/takekazuomi/9742159560"><img alt="matuyama by Takekazu Omi, on Flickr" class="align-center" src="http://farm8.staticflickr.com/7416/9742159560_500e7d6301.jpg"/></a>
<div class="line-block">
<div class="line"><br/></div>
</div>
</div>
<div class="section" id="id6">
<h2>問題点の確認</h2>
<p>問題点は下記の3つが有りました。「3」は、既に、<a class="reference internal" href="2013/11/30/fixed_storage_client_cast_problem_in_2013_08_15_version.html"><span class="doc">Storage Client 2.1.0.4 以降での Cast問題の修正</span></a>で、Client Library 2.1.0.4、3.xで修正確認ができているので、ここでは1と2を確認します。</p>
<ol class="arabic simple">
<li><a class="reference internal" href="2013/11/24/windows_azure_storage_known_issues_2013_11.html#known-issue-20131101"><span class="std std-ref">SASとコンテナの前の// 問題</span></a></li>
<li><a class="reference internal" href="2013/11/24/windows_azure_storage_known_issues_2013_11.html#known-issue-20131102"><span class="std std-ref">TableのDataServiceContext.ResolveName 指定 問題</span></a></li>
<li><a class="reference internal" href="2013/11/24/windows_azure_storage_known_issues_2013_11.html#known-issue-201311"><span class="std std-ref">Table Query での Cast 問題</span></a></li>
</ol>
</div>
<div class="section" id="sas">
<h2><a class="reference internal" href="2013/11/24/windows_azure_storage_known_issues_2013_11.html#known-issue-20131101"><span class="std std-ref">SASとコンテナの前の “//” 問題</span></a></h2>
<p>下記のようなプログラムで確認しました。Signitureの生成結果を確認しやすいように、2013/12/01から一年有効なREADのSASにしています。Storage Client 2.1.0.4 では、2012-02-12 versionが使われて、コンテナの前が<span class="docutils literal"><span class="pre">"//"</span></span>になっていても動きましたが、3.0.1だと、2013-08-15 versionが使われ、400 のエラーで弾かれるという結果になりました。もともと、<span class="docutils literal"><span class="pre">"//"</span></span>と書いたら<span class="docutils literal"><span class="pre">"/"</span></span>と解釈されるというのはあまりイケてない動きなので、古いバージョンのみ互換性を持つように変更して新しいものでは動作変更ということにしたのは妥当な落とし所かと思います。Storage Versionによって動作が違うようです。</p>
<div class="highlight-c# notranslate"><div class="highlight"><pre><span/><span class="k">private</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetSASUrl</span><span class="p">(</span><span class="n">CloudStorageAccount</span> <span class="n">storageAccount</span><span class="p">,</span> <span class="kt">string</span> <span class="n">containerName</span><span class="p">,</span> <span class="kt">string</span> <span class="n">blobName</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">blobClient</span> <span class="p">=</span> <span class="n">storageAccount</span><span class="p">.</span><span class="n">CreateCloudBlobClient</span><span class="p">();</span>

    <span class="kt">var</span> <span class="n">container</span> <span class="p">=</span> <span class="n">blobClient</span><span class="p">.</span><span class="n">GetContainerReference</span><span class="p">(</span><span class="n">containerName</span><span class="p">);</span>

    <span class="kt">var</span> <span class="n">blockBlob</span> <span class="p">=</span> <span class="n">container</span><span class="p">.</span><span class="n">GetBlockBlobReference</span><span class="p">(</span><span class="n">blobName</span><span class="p">);</span>

    <span class="kt">var</span> <span class="n">startDate</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="s">"2013/12/01"</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">sas</span> <span class="p">=</span> <span class="n">blockBlob</span><span class="p">.</span><span class="n">GetSharedAccessSignature</span><span class="p">(</span><span class="k">new</span> <span class="n">SharedAccessBlobPolicy</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Permissions</span> <span class="p">=</span> <span class="n">SharedAccessBlobPermissions</span><span class="p">.</span><span class="n">Read</span><span class="p">,</span>
        <span class="n">SharedAccessStartTime</span> <span class="p">=</span> <span class="n">startDate</span><span class="p">,</span>
        <span class="n">SharedAccessExpiryTime</span> <span class="p">=</span> <span class="n">startDate</span><span class="p">.</span><span class="n">AddYears</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
    <span class="p">});</span>
    
    <span class="k">return</span> <span class="n">blockBlob</span><span class="p">.</span><span class="n">Uri</span><span class="p">.</span><span class="n">ToString</span><span class="p">()</span> <span class="p">+</span> <span class="n">sas</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br/></div>
</div>
<div class="section" id="id7">
<h3>2.1.0.4での確認結果</h3>
<p><span class="docutils literal"><span class="pre">Install-Package</span> <span class="pre">WindowsAzure.Storage</span> <span class="pre">-Version</span> <span class="pre">2.1.0.4</span></span>で2.1.0.4を入れます。何度も、違うバージョンのライブラリを入れ替えて使っていて、混乱したので念のためpackage.configの内容を併記します。</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span/><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;packages&gt;</span>
  <span class="nt">&lt;package</span> <span class="na">id=</span><span class="s">"Microsoft.Data.Edm"</span> <span class="na">version=</span><span class="s">"5.2.0"</span> <span class="na">targetFramework=</span><span class="s">"net451"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;package</span> <span class="na">id=</span><span class="s">"Microsoft.Data.OData"</span> <span class="na">version=</span><span class="s">"5.2.0"</span> <span class="na">targetFramework=</span><span class="s">"net451"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;package</span> <span class="na">id=</span><span class="s">"Microsoft.WindowsAzure.ConfigurationManager"</span> <span class="na">version=</span><span class="s">"1.8.0.0"</span> <span class="na">targetFramework=</span><span class="s">"net451"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;package</span> <span class="na">id=</span><span class="s">"System.Spatial"</span> <span class="na">version=</span><span class="s">"5.2.0"</span> <span class="na">targetFramework=</span><span class="s">"net451"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;package</span> <span class="na">id=</span><span class="s">"WindowsAzure.Storage"</span> <span class="na">version=</span><span class="s">"2.1.0.4"</span> <span class="na">targetFramework=</span><span class="s">"net451"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/packages&gt;</span>
</pre></div>
</div>
<p>生成されたURLで成功を確認</p>
<blockquote>
<div><div class="line-block">
<div class="line"><a class="reference external" href="http://test.blob.core.windows.net/images/photo.jpg?sv=2012-02-12&amp;se=2014-11-30T15%3A00%3A00Z&amp;sr=b&amp;sp=r&amp;sig=[signiture">http://test.blob.core.windows.net/images/photo.jpg?sv=2012-02-12&amp;se=2014-11-30T15%3A00%3A00Z&amp;sr=b&amp;sp=r&amp;sig=[signiture</a>]</div>
</div>
</div></blockquote>
<p>コンテナの前に、<span class="docutils literal"><span class="pre">"/"</span></span>を追加して確認、成功！</p>
<blockquote>
<div><div class="line-block">
<div class="line"><a class="reference external" href="http://test.blob.core.windows.net//images/photo.jpg?sv=2012-02-12&amp;se=2014-11-30T15%3A00%3A00Z&amp;sr=b&amp;sp=r&amp;sig=[signiture">http://test.blob.core.windows.net//images/photo.jpg?sv=2012-02-12&amp;se=2014-11-30T15%3A00%3A00Z&amp;sr=b&amp;sp=r&amp;sig=[signiture</a>]</div>
</div>
</div></blockquote>
<p><span class="docutils literal"><span class="pre">sv=2012-02-12</span></span>になっていて、versionがわかります。</p>
</div>
<div class="section" id="id8">
<h3>3.0.1での確認結果</h3>
<p><span class="docutils literal"><span class="pre">Install-Package</span> <span class="pre">WindowsAzure.Storage</span></span>で最新版、3.0.1で確認</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span/><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;packages&gt;</span>
  <span class="nt">&lt;package</span> <span class="na">id=</span><span class="s">"Microsoft.Data.Edm"</span> <span class="na">version=</span><span class="s">"5.6.0"</span> <span class="na">targetFramework=</span><span class="s">"net451"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;package</span> <span class="na">id=</span><span class="s">"Microsoft.Data.OData"</span> <span class="na">version=</span><span class="s">"5.6.0"</span> <span class="na">targetFramework=</span><span class="s">"net451"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;package</span> <span class="na">id=</span><span class="s">"Microsoft.Data.Services.Client"</span> <span class="na">version=</span><span class="s">"5.6.0"</span> <span class="na">targetFramework=</span><span class="s">"net451"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;package</span> <span class="na">id=</span><span class="s">"Microsoft.WindowsAzure.ConfigurationManager"</span> <span class="na">version=</span><span class="s">"1.8.0.0"</span> <span class="na">targetFramework=</span><span class="s">"net451"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;package</span> <span class="na">id=</span><span class="s">"Newtonsoft.Json"</span> <span class="na">version=</span><span class="s">"5.0.8"</span> <span class="na">targetFramework=</span><span class="s">"net451"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;package</span> <span class="na">id=</span><span class="s">"System.Spatial"</span> <span class="na">version=</span><span class="s">"5.6.0"</span> <span class="na">targetFramework=</span><span class="s">"net451"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;package</span> <span class="na">id=</span><span class="s">"WindowsAzure.Storage"</span> <span class="na">version=</span><span class="s">"3.0.1.0"</span> <span class="na">targetFramework=</span><span class="s">"net451"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/packages&gt;</span>
</pre></div>
</div>
<p>生成されたURLで成功を確認</p>
<blockquote>
<div><div class="line-block">
<div class="line"><a class="reference external" href="http://test.blob.core.windows.net/images/photo.jpg?sv=2013-08-15&amp;sr=b&amp;sig=[signiture]&amp;se=2014-11-30T15%3A00%3A00Z&amp;sp=r">http://test.blob.core.windows.net/images/photo.jpg?sv=2013-08-15&amp;sr=b&amp;sig=[signiture]&amp;se=2014-11-30T15%3A00%3A00Z&amp;sp=r</a></div>
</div>
</div></blockquote>
<p>コンテナの前に、<span class="docutils literal"><span class="pre">"/"</span></span>を追加。これは失敗します。</p>
<blockquote>
<div><div class="line-block">
<div class="line"><a class="reference external" href="http://test.blob.core.windows.net//images/photo.jpg?sv=2013-08-15&amp;sr=b&amp;sig=[signiture]&amp;se=2014-11-30T15%3A00%3A00Z&amp;sp=r">http://test.blob.core.windows.net//images/photo.jpg?sv=2013-08-15&amp;sr=b&amp;sig=[signiture]&amp;se=2014-11-30T15%3A00%3A00Z&amp;sp=r</a></div>
</div>
</div></blockquote>
<p>レスポンスを見ると下記のようになっていました。（XMLは整形してあります）</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span/>HTTP/1.1 400 The requested URI does not represent any resource on the server.
Content-Length: 434
Content-Type: application/xml
Server: Microsoft-HTTPAPI/2.0
x-ms-request-id: a9275897-8810-48b2-bcd5-d45af85f6f14
Date: Fri, 27 Dec 2013 12:34:46 GMT

&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;Error&gt;
  &lt;Code&gt;InvalidUri&lt;/Code&gt;
  &lt;Message&gt;
    The requested URI does not represent any resource on the server.
    RequestId:a9275897-8810-48b2-bcd5-d45af85f6f14
    Time:2013-12-27T12:34:46.6851586Z
  &lt;/Message&gt;
  &lt;UriPath&gt;
  http://test.blob.core.windows.net//images/photo.jpg?sv=2013-08-15&amp;amp;sr=b&amp;amp;sig=[signiture]&amp;amp;se=2014-11-30T15:00:00Z&amp;amp;sp=r
  &lt;/UriPath&gt;
&lt;/Error&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="tabledataservicecontext-resolvename">
<h2><a class="reference internal" href="2013/11/24/windows_azure_storage_known_issues_2013_11.html#known-issue-20131102"><span class="std std-ref">TableのDataServiceContext.ResolveName 指定 問題</span></a></h2>
<p>同様に、下記のようなコードを使って、2.1.0.4と、3.0.1で確認しました。 2.1.0.4 では、動作しましたが 3.0.1 では動きませんでした。結果はSASと似ているのですが、service側では処理が成功しているのでちょっと違った感じを受けます。</p>
<div class="highlight-c# notranslate"><div class="highlight"><pre><span/><span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">ResolveName</span><span class="p">(</span><span class="n">CloudStorageAccount</span> <span class="n">storageAccount</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">cloudTableClient</span> <span class="p">=</span> <span class="n">storageAccount</span><span class="p">.</span><span class="n">CreateCloudTableClient</span><span class="p">();</span>

    <span class="kt">var</span> <span class="n">table</span> <span class="p">=</span> <span class="n">cloudTableClient</span><span class="p">.</span><span class="n">GetTableReference</span><span class="p">(</span><span class="s">"sometable"</span><span class="p">);</span>
    <span class="n">table</span><span class="p">.</span><span class="n">CreateIfNotExists</span><span class="p">();</span>

    <span class="kt">var</span> <span class="n">tableServiceContext</span> <span class="p">=</span> <span class="n">cloudTableClient</span><span class="p">.</span><span class="n">GetTableServiceContext</span><span class="p">();</span>
    <span class="n">tableServiceContext</span><span class="p">.</span><span class="n">ResolveName</span> <span class="p">=</span> <span class="n">entityType</span> <span class="p">=&gt;</span> <span class="n">entityType</span><span class="p">.</span><span class="n">FullName</span><span class="p">;</span>

    <span class="kt">var</span> <span class="n">entity</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SimpleEntity</span><span class="p">(</span><span class="s">"somePK"</span><span class="p">,</span> <span class="s">"someRK2"</span><span class="p">);</span>
    <span class="n">tableServiceContext</span><span class="p">.</span><span class="n">AddObject</span><span class="p">(</span><span class="s">"sometable"</span><span class="p">,</span> <span class="n">entity</span><span class="p">);</span>
    <span class="n">tableServiceContext</span><span class="p">.</span><span class="n">SaveChanges</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br/></div>
</div>
<div class="section" id="id9">
<h3>2.1.0.4での確認結果</h3>
<p>普通に動いて成功しました。リクエストを見ると、categoryの属性に、<span class="docutils literal"><span class="pre">term="StorageIssue201311.SimpleEntity"</span></span>と有りますが、正常に処理されてレスポンスが帰ってきているのがわかります。</p>
<p>参考までに、リクエストとレスポンスを貼っておきます</p>
<p>リクエスト</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span/>POST http://test.table.core.windows.net/sometable HTTP/1.1
User-Agent: Microsoft ADO.NET Data Services
DataServiceVersion: 1.0;NetFx
MaxDataServiceVersion: 2.0;NetFx
x-ms-date: Fri, 27 Dec 2013 13:30:17 GMT
Authorization: SharedKeyLite [signiture]
x-ms-version: 2012-02-12
Accept: application/atom+xml,application/xml
Accept-Charset: UTF-8
Content-Type: application/atom+xml
Host: test.table.core.windows.net
Content-Length: 735

&lt;?xml version="1.0" encoding="utf-8" standalone="yes"?&gt;
&lt;entry xmlns:d="http://schemas.microsoft.com/ado/2007/08/dataservices" xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata" xmlns="http://www.w3.org/2005/Atom"&gt;
  &lt;category scheme="http://schemas.microsoft.com/ado/2007/08/dataservices/scheme" term="StorageIssue201311.SimpleEntity" /&gt;
  &lt;title /&gt;
  &lt;author&gt;
    &lt;name /&gt;
  &lt;/author&gt;
  &lt;updated&gt;2013-12-27T13:30:17.8428287Z&lt;/updated&gt;
  &lt;id /&gt;
  &lt;content type="application/xml"&gt;
    &lt;m:properties&gt;
      &lt;d:PartitionKey&gt;somePK&lt;/d:PartitionKey&gt;
      &lt;d:RowKey&gt;someRK7&lt;/d:RowKey&gt;
      &lt;d:Timestamp m:type="Edm.DateTime"&gt;0001-01-01T00:00:00&lt;/d:Timestamp&gt;
    &lt;/m:properties&gt;
  &lt;/content&gt;
&lt;/entry&gt;
</pre></div>
</div>
<p>レスポンス</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span/>HTTP/1.1 201 Created
Cache-Control: no-cache
Transfer-Encoding: chunked
Content-Type: application/atom+xml;type=entry;charset=utf-8
ETag: W/"datetime'2013-12-27T13%3A30%3A08.6638521Z'"
Location: http://test.table.core.windows.net/sometable(PartitionKey='somePK',RowKey='someRK7')
Server: Windows-Azure-Table/1.0 Microsoft-HTTPAPI/2.0
x-ms-request-id: 765ae397-974c-4f3c-9d3a-d4e99bdcf9f5
x-ms-version: 2012-02-12
X-Content-Type-Options: nosniff
Date: Fri, 27 Dec 2013 13:30:08 GMT

3AE
&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;entry xml:base="http://test.table.core.windows.net/" xmlns="http://www.w3.org/2005/Atom" xmlns:d="http://schemas.microsoft.com/ado/2007/08/dataservices" xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata" m:etag="W/&amp;quot;datetime'2013-12-27T13%3A30%3A08.6638521Z'&amp;quot;"&gt;&lt;id&gt;http://test.table.core.windows.net/sometable(PartitionKey='somePK',RowKey='someRK7')&lt;/id&gt;&lt;category term="test.sometable" scheme="http://schemas.microsoft.com/ado/2007/08/dataservices/scheme" /&gt;&lt;link rel="edit" title="sometable" href="sometable(PartitionKey='somePK',RowKey='someRK7')" /&gt;&lt;title /&gt;&lt;updated&gt;2013-12-27T13:30:08Z&lt;/updated&gt;&lt;author&gt;&lt;name /&gt;&lt;/author&gt;&lt;content type="application/xml"&gt;&lt;m:properties&gt;&lt;d:PartitionKey&gt;somePK&lt;/d:PartitionKey&gt;&lt;d:RowKey&gt;someRK7&lt;/d:RowKey&gt;&lt;d:Timestamp m:type="Edm.DateTime"&gt;2013-12-27T13:30:08.6638521Z&lt;/d:Timestamp&gt;&lt;/m:properties&gt;&lt;/content&gt;&lt;/entry&gt;
0


</pre></div>
</div>
<div class="line-block">
<div class="line"><br/></div>
</div>
</div>
<div class="section" id="id10">
<h3>3.0.1での確認結果</h3>
<p><span class="docutils literal"><span class="pre">Install-Package</span> <span class="pre">WindowsAzure.Storage</span></span>として最新版、3.0.1で確認したところ、下記のようにエラーになりました。データ自体は、Tableに入っており正常終了していますが、レスポンスを読み込んでエンティティを更新するのに失敗しているようです。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span/>ハンドルされていない例外: System.Data.Services.Client.DataServiceRequestException: この要求の処理中にエラーが発生しました。 ---&gt; System.InvalidOperationException: メタデータ URI 'http://fooomiimg001.table.core.windows.net/$metadata#sometable/@Element' は 'fooomiimg001.sometable' という名前のエンティティ型を参照していますが、予期されたエンティティ型の名前は 'StorageIssue201311.SimpleEntity' で、'fooomiimg001.sometable' という名前のエンティティ型と互換性がありません。 ---&gt; Microsoft.Data.OData.ODataException: メタデータ URI 'http://fooomiimg001.table.core.windows.net/$metadata#sometable/@Element' は 'fooomiimg001.sometable' という名前のエンティティ型を参照していますが、予期されたエンティティ型の名前は 'StorageIssue201311.SimpleEntity' で、'fooomiimg001.sometable' という名前のエンティティ型と互換性がありません。
   場所 Microsoft.Data.OData.ReaderValidationUtils.ValidateFeedOrEntryMetadataUri(ODataJsonLightMetadataUriParseResult metadataUriParseResult, Scope scope)
   場所 Microsoft.Data.OData.JsonLight.ODataJsonLightReader.ReadAtStartImplementationSynchronously(DuplicatePropertyNamesChecker duplicatePropertyNamesChecker)
   場所 Microsoft.Data.OData.JsonLight.ODataJsonLightReader.ReadAtStartImplementation()
   場所 Microsoft.Data.OData.ODataReaderCore.ReadImplementation()
   場所 Microsoft.Data.OData.ODataReaderCore.ReadSynchronously()
   場所 Microsoft.Data.OData.ODataReaderCore.InterceptException[T](Func`1 action)
   場所 Microsoft.Data.OData.ODataReaderCore.Read()
   場所 System.Data.Services.Client.Materialization.ODataReaderWrapper.Read()
   場所 System.Data.Services.Client.Materialization.FeedAndEntryMaterializerAdapter.TryRead()
   --- 内部例外スタック トレースの終わり ---
   場所 System.Data.Services.Client.Materialization.FeedAndEntryMaterializerAdapter.TryRead()
   場所 System.Data.Services.Client.Materialization.FeedAndEntryMaterializerAdapter.TryStartReadFeedOrEntry()
   場所 System.Data.Services.Client.Materialization.FeedAndEntryMaterializerAdapter.TryReadFeedOrEntry(Boolean lazy, ODataFeed&amp; feed, MaterializerEntry&amp; entry)
   場所 System.Data.Services.Client.Materialization.FeedAndEntryMaterializerAdapter.Read()
   場所 System.Data.Services.Client.Materialization.ODataReaderEntityMaterializer.ParseSingleEntityPayload(IODataResponseMessage message, ResponseInfo responseInfo, Type expectedType)
   場所 System.Data.Services.Client.SaveResult.HandleOperationResponseData(IODataResponseMessage responseMsg, Stream responseStream)
   --- 内部例外スタック トレースの終わり ---
   場所 System.Data.Services.Client.SaveResult.HandleResponse()
   場所 System.Data.Services.Client.BaseSaveResult.EndRequest()
   場所 System.Data.Services.Client.DataServiceContext.SaveChanges(SaveChangesOptions options)
   場所 System.Data.Services.Client.DataServiceContext.SaveChanges()
   場所 StorageIssue201311.Program.ResolveName(CloudStorageAccount storageAccount) 場所 c:\Users\Takekazu\Documents\GitHub\sandbox\csharp\StorageIssue201311\StorageIssue201311\Program.cs:行 52
   場所 StorageIssue201311.Program.Main(String[] args) 場所 c:\Users\Takekazu\Documents\GitHub\sandbox\csharp\StorageIssue201311\StorageIssue201311\Program.cs:行 59







</pre></div>
</div>
<p>参考までに、リクエストとレスポンスを貼っておきます。これを見ると、x-ms-version: 2013-08-15 で、payloadは、<span class="docutils literal"><span class="pre">Content-Type:</span> <span class="pre">application/json;odata=minimalmetadata</span></span>になっていますが、<span class="docutils literal"><span class="pre">Prefer:</span> <span class="pre">return-no-content</span></span>が指定されておらず、レスポンスのBodyにechoが帰ってきているのがわかります。</p>
<p>リクエスト</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span/>POST http://test.table.core.windows.net/sometable HTTP/1.1
DataServiceVersion: 3.0;NetFx
MaxDataServiceVersion: 3.0;NetFx
Accept: application/json;odata=minimalmetadata
Accept-Charset: UTF-8
User-Agent: Microsoft ADO.NET Data Services
x-ms-date: Fri, 27 Dec 2013 13:07:55 GMT
Authorization: SharedKeyLite [signiture]
x-ms-version: 2013-08-15
Content-Type: application/json;odata=minimalmetadata
Host: test.table.core.windows.net
Content-Length: 125

{"odata.type":"StorageIssue201311.SimpleEntity","PartitionKey":"somePK","RowKey":"someRK6","Timestamp":"0001-01-01T00:00:00"}
</pre></div>
</div>
<p>レスポンス</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span/>HTTP/1.1 201 Created
Cache-Control: no-cache
Transfer-Encoding: chunked
Content-Type: application/json;odata=minimalmetadata;streaming=true;charset=utf-8
ETag: W/"datetime'2013-12-27T13%3A07%3A45.3753816Z'"
Location: http://test.table.core.windows.net/sometable(PartitionKey='somePK',RowKey='someRK6')
Server: Windows-Azure-Table/1.0 Microsoft-HTTPAPI/2.0
x-ms-request-id: b1797f33-1888-487a-a0cb-0a454fca1356
x-ms-version: 2013-08-15
X-Content-Type-Options: nosniff
Date: Fri, 27 Dec 2013 13:07:45 GMT

B2
{"odata.metadata":"http://test.table.core.windows.net/$metadata#sometable/@Element","PartitionKey":"somePK","RowKey":"someRK6","Timestamp":"2013-12-27T13:07:45.3753816Z"}
0


</pre></div>
</div>
</div>
</div>
<div class="section" id="id11">
<h2>まとめ</h2>
<p><a class="reference internal" href="2013/11/24/windows_azure_storage_known_issues_2013_11.html"><span class="doc">Windows Azure Storage Known Issues 2013/11</span></a>で報告されている既知の Braking Change は、2.1.0.4 の修正と、サーバー側(service)の修正でFIXされました。ただし、<a class="reference internal" href="2013/11/24/windows_azure_storage_known_issues_2013_11.html#known-issue-20131101"><span class="std std-ref">SASとコンテナの前の “//” 問題</span></a>は、2013-08-15 version では仕様となり、<a class="reference internal" href="2013/11/24/windows_azure_storage_known_issues_2013_11.html#known-issue-20131102"><span class="std std-ref">TableのDataServiceContext.ResolveName 指定 問題</span></a>も、Storage Client 3.0.1 では、ResolveNameの指定をすると動作しません。 最新のライブラリを使う場合はコードを直して欲しいということだと思います。</p>
<p>2.1系のライブラリを使う場合は上記3点の問題がFIXされた 2.1.0.4 がお勧めです。3.x系は、幾つかのBraking Changeが含まれるので既存のコードは移行が必要ですが、2013-08-15 versionのパフォーマンス向上策がちゃんと活用できるのが大きな利点だと言えます。</p>
<div class="line-block">
<div class="line"><br/></div>
<div class="line"><br/></div>
</div>
<table class="docutils footnote" frame="void" id="r1" rules="none">
<colgroup><col class="label"/><col/></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>日本語訳<a class="reference external" href="http://blogs.msdn.com/b/windowsazurej/archive/2013/11/29/blog-windows-azure-storage-known-issues.aspx">Windows Azure ストレージの既知の問題</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="r2" rules="none">
<colgroup><col class="label"/><col/></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[2]</a></td><td>gitbugの<a class="reference external" href="https://github.com/WindowsAzure/azure-sdk-for-net/">WindowsAzure/azure-sdk-for-net</a>レポジトリのmasterには、Storage Clientのコードは既にありません。2.1.0.4を確認するには、<a class="reference external" href="https://github.com/WindowsAzure/azure-sdk-for-net/tree/v2.1.0.4/microsoft-azure-api/Services/Storage">tag:v2.1.0.4 Storage</a>を見て下さい。</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="r3" rules="none">
<colgroup><col class="label"/><col/></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[3]</a></td><td><a class="reference external" href="https://github.com/WindowsAzure/azure-storage-net">3.x github</a></td></tr>
</tbody>
</table>
</div>

        </div>
        <div class="postmeta">
        <div class="author">
            <span>Posted by Takekazu Omi</span>
        </div>
        <div class="categories">
            <span>
                Filed under:
                <a href="categories/azure_table.html">Azure Table</a>, <a href="categories/azure.html">Azure</a></span>
        </div>
        <div class="tags">
            <span>
                Tags:
                <a href="tags/azure_table.html">Azure Table</a>, <a href="tags/table.html">Table</a>, <a href="tags/storage.html">Storage</a>, <a href="tags/issue.html">Issue</a>, <a href="tags/fixed.html">Fixed</a>, <a href="tags/azure_blob.html">Azure Blob</a></span>
        </div>
        <div class="comments">
            <a href="http://kyrt.in/2013/12/27/azure_storage_known_issues_november_2013_resolved.html#disqus_thread" data-disqus-identifier="2013/12/27/azure_storage_known_issues_november_2013_resolved">Leave a comment</a>
        </div></div><div class="separator post_separator"></div><div class="timestamp postmeta">
            <span>December 22, 2013</span>
        </div>
        <div class="section">
            <h1><a href="2013/12/22/azure_posh_2012_12_19_version_0_7_2_1.html">Windows Azure Powershell 0.7.2.1 リリース</a></h1>
<p>Windows Azure Powershello 0.7.2.1 Hotfix がリリースされました。<a class="reference internal" href="2013/12/11/windows_azure_powershel_0_7_2_release.html"><span class="doc">Windows Azure PowerShell 0.7.2 リリース</span></a>のHotfix です。</p>
<blockquote>
<div><div class="line-block">
<div class="line">修正: Hive query “%” が含まれた場合のエンコーディングの問題をFIX <a class="reference external" href="https://github.com/WindowsAzure/azure-sdk-tools/blob/master/ChangeLog.txt#L1">ChangeLog.txt</a></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br/></div>
</div>
<a class="reference external image-reference" href="http://www.flickr.com/photos/takekazuomi/11233678353"><img alt="beans persimmon by Takekazu Omi, on Flickr" class="align-center" src="http://farm8.staticflickr.com/7405/11233678353_a8e7a8b12f_c.jpg"/></a>
<div class="line-block">
<div class="line"><br/></div>
</div>
<div class="section" id="id1">
<h2>インストール</h2>
<p>Web Platform Installer を使うと最新版が入ります。12/18 リリースのWindows Azure Poershell を選択してください。</p>
<img alt="../../../_images/2013_12_22_webpi001.png" src="_images/2013_12_22_webpi001.png"/>
<p>インストールしたら念のためバージョンを確認します。Azureの所が、0.7.2 のママです orz….</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span/>$ Get-Module <span class="p">|</span> ft name,version

Name                                                        Version
----                                                        -------
Autoload                                                    <span class="m">0</span>.0
Azure                                                       <span class="m">0</span>.7.2
Microsoft.PowerShell.Management                             <span class="m">3</span>.1.0.0
Microsoft.PowerShell.Utility                                <span class="m">3</span>.1.0.0
posh-git                                                    <span class="m">0</span>.0
PsEnv                                                       <span class="m">0</span>.0
PSReadline                                                  <span class="m">1</span>.0.0.1
</pre></div>
</div>
<p>今回のリリースでは、ModuleVersion が変更されていません。<a class="reference external" href="https://github.com/WindowsAzure/azure-sdk-tools/blob/master/WindowsAzurePowershell/src/Commands.Utilities/Azure.psd1#L15">Azure.psd1#L15</a>要注意です。</p>
<p>確認のためインストール先のアセンブリを見ます。</p>
<p>手元の環境では、<cite>C:Program Files (x86)Microsoft SDKsWindows AzurePowerShellAzure</cite>にインストールされています。 Explorer で、<cite>Microsoft.WindowsAzure.Commands.dll</cite>のプロパティを確認したら下記のようになっていました。0.7.2.1になっているようです。</p>
<img alt="../../../_images/2013_12_22_asm001.png" class="align-center" src="_images/2013_12_22_asm001.png"/>
</div>
<div class="section" id="id2">
<h2>最後に</h2>
<p>更新だけする場合は、Web Platform Installer を起動して新しいものが出ているかどうかを確認するのが一番簡単です。</p>
<p>この方法だと、現在入っているバージョンは分からないので、現在入っているバージョンを知りたければ、<cite>Get-Module | ft name,version</cite>して、0.7.2 だったら、アセンプリのバージョンを見て0.7.2.1かどうかの確認をするということになります。</p>
<p>ちょっと面倒ですね。</p>
</div>
<div class="section" id="id3">
<h2>2013/12/23 追記</h2>
<p>ModuleVersionが更新されていない件について、GitHubに<a class="reference external" href="https://github.com/WindowsAzure/azure-sdk-tools/issues/2189">Issue</a>を上げました。</p>
</div>
<div class="section" id="azure-posh-0721-verfix">
<span id="id4"/><h2>2014/1/8 追記</h2>
<p><a class="reference external" href="https://github.com/WindowsAzure/azure-sdk-tools/issues/2189">Issue</a>に「0.7.3 で直すよ」と返事をもらいました<a class="reference external" href="https://github.com/WindowsAzure/azure-sdk-tools/issues/2189#issuecomment-31790944">This will be fixed in 0.7.3</a>まだ、0.x ですし、バージョン番号を変更するためにリリースするのもどうかと思うので妥当な判断だと思います。</p>
<p>ちなみに、バージョン番号は、<a class="reference external" href="http://semver.org/">Semantic Versioning</a>に沿って付けられているそうです。nugetでは、<a class="reference external" href="http://docs.nuget.org/docs/reference/versioning">Versioning</a>は、semverなので揃える方向性なんでしょうか、開発者的には分かりやすくなって嬉しいですね。</p>
</div>

        </div>
        <div class="postmeta">
        <div class="author">
            <span>Posted by Takekazu Omi</span>
        </div>
        <div class="categories">
            <span>
                Filed under:
                <a href="categories/azure.html">Azure</a>, <a href="categories/azure_powershell.html">Azure PowerShell</a>, <a href="categories/github観察記.html">GitHub観察記</a></span>
        </div>
        <div class="tags">
            <span>
                Tags:
                <a href="tags/azure.html">Azure</a>, <a href="tags/azure_powershell.html">Azure PowerShell</a>, <a href="tags/powershell.html">PowerShell</a>, <a href="tags/posh.html">posh</a>, <a href="tags/hotfix.html">Hotfix</a></span>
        </div>
        <div class="comments">
            <a href="http://kyrt.in/2013/12/22/azure_posh_2012_12_19_version_0_7_2_1.html#disqus_thread" data-disqus-identifier="2013/12/22/azure_posh_2012_12_19_version_0_7_2_1">Leave a comment</a>
        </div></div><div class="separator post_separator"></div><div class="timestamp postmeta">
            <span>December 21, 2013</span>
        </div>
        <div class="section">
            <h1><a href="2013/12/21/windows_azure_storage_client_library_for_c_preview.html">Windows Azure Storage Client Library for C++ Preview</a></h1>
<p><a class="reference external" href="http://blogs.msdn.com/b/windowsazurestorage/archive/2013/12/20/windows-azure-storage-client-library-for-cplusplus-preview.aspx">Windows Azure Storage Client Library for C++ Preview がリリースされました</a></p>
<blockquote>
<div><div class="line-block">
<div class="line">2013/12/27 Windows Azure Japan Team Blog 公式 谷訳出ました。 <a class="reference external" href="http://blogs.msdn.com/b/windowsazurej/archive/2013/12/27/windows-azure-storage-client-library-for-c-preview.aspx">C++ 用 Windows Azure ストレージ クライアント ライブラリのプレビュー版をリリース</a></div>
</div>
</div></blockquote>
<p>待望のC++用のライブラリです。</p>
<p>以下にざっくりと訳します。</p>
<div class="section" id="id2">
<h2>抄訳 Windows Azure Storage Client Library for C++ Preview</h2>
<p>これは、Preview release です、まだ puroduction codeでは使用しないでください（should not be used in your production code）。 その代わり、ざっと目を通して試してみて、あなたがGAに必要だと考える拡張・変更のフィードバックを下さい。</p>
<p>Windows Azure Storage に付いての詳しい情報は、SOSP Paper<a class="reference external" href="http://blogs.msdn.com/b/windowsazurestorage/archive/2011/11/20/windows-azure-storage-a-highly-available-cloud-storage-service-with-strong-consistency.aspx">Windows Azure Storage: A Highly Available Cloud Storage Service with Strong Consistency</a><a class="footnote-reference" href="#r1" id="id3">[1]</a>を参照してください。</p>
<div class="section" id="emulator-guidance">
<h3>Emulator Guidance</h3>
<p>このライブラリが使う<a class="reference external" href="http://msdn.microsoft.com/en-us/library/windowsazure/dd894041.aspx">2013-08-15 REST</a>は、現在のAzure SDK(2.2)のStorage Emulatorでサポートされていません。これらの全ての機能をサポートしたAzure Storage Emulatorのアップデートを来月には出せる見込みです。(An updated Windows Azure Storage Emulator is expected to ship with full support of these new features in the next month)Storage Emulatorの現在のバージョンを使って開発しようとすると不正な要求エラーを受け取ることになります。アップデートが出るまでは、新機能を使用したいユーザーは、Windows Azure Storage Account (本番環境）を使ってテストをして下さい。<a class="footnote-reference" href="#r2" id="id4">[2]</a></p>
</div>
<div class="section" id="id5">
<h3>サポートされるプラットフォーム</h3>
<p>今回のリリースでは、Visual Studio 2012 (v110) と Visual Studio 2013 (v120) platform toolsets 用ライブラリの x64およびx86バージョンを提供します。パッケージには、8 build flavors が含まれます。</p>
<ol class="arabic simple">
<li>Release, x64, v120</li>
<li>Debug, x64, v120</li>
<li>Release, Win32, v120</li>
<li>Debug, Win32, v120</li>
<li>Release, x64, v110</li>
<li>Debug, x64, v110</li>
<li>Release, Win32, v110</li>
<li>Debug, Win32, v110</li>
</ol>
</div>
<div class="section" id="id6">
<h3>入手方法</h3>
<p>ライブラリは、<a class="reference external" href="http://www.nuget.org/packages/wastorage">NuGet</a>から、完全なソースコードは<a class="reference external" href="https://github.com/WindowsAzure/azure-storage-cpp">GitHub</a>からダウンロードできます。NuGet packageは、<a class="reference external" href="http://coapp.org/">CoApp tools</a>を使って作成され、3つのpackage として構成されています。</p>
<ul class="simple">
<li>wastorage.0.2.0-preview.nupkg：このパッケージには、アプリケーションの開発に必要なヘッダーとLIBファイルが含まれています。これは、再配布（redist） package に依存します。NuGet は、自動的にredist packageのインストールを行います。</li>
<li>wastorage.redist.0.2.0-preview.nupkg：このパッケージを実行し、アプリケーションを再配布するために必要なDLLファイルが含まれています。</li>
<li>wastorage.symbols.0.2.0-preview.nupkg：このパッケージには、それぞれのDLLファイルのシンボルが含まれています。オプションのパッケージです。</li>
</ul>
<p>パッケージは、<a class="reference external" href="https://www.nuget.org/packages/cpprestsdk/">C++ REST SDK</a>に依存しており、それもNuGetで自動的にインストールされます。<a class="reference external" href="http://casablanca.codeplex.com/">C++ REST SDK (codename “Casablanca”)</a>は、native code の cloud-based client-server communication のための Microsoft のプロジェクトです。これは、native code の REST services アクセスを、multiple platforms で非同期な HTTP, JSON, URIs の C++ bindings として提供します。Windows Azure Storage Client Library では、このライブラリを Windows Azure Storage Blob, Queue, Table services との通信で利用しています。</p>
</div>
<div class="section" id="id7">
<h3>できること</h3>
<p>ここでは、REST API に付いて話をする代わりに、Windows Azure Storage Client Library の概要を説明します。</p>
<ul class="simple">
<li>Windows Azure Storage REST API version<a class="reference external" href="http://blogs.msdn.com/b/windowsazurestorage/archive/2013/11/27/windows-azure-storage-release-introducing-cors-json-minute-metrics-and-more.aspx">2013-08-15</a>全体を簡単に使えるようにする実装</li>
<li>Retry policies: リクエストが失敗した場合の再試行ロジックとして、exponential や linear back off algorithm を実装</li>
<li>Streamlined authentication model: 共有鍵と共有認証署名の両方をサポート</li>
<li>操作コンテキストとETWのログを使用して要求の詳細と結果に潜り込む能力</li>
<li>サイズや、Blob typeに関係の無い、ユーザー設定による、parallel block/page アップロード</li>
<li>特定のupload/download APIに対応しなくても、読み取りまたはBLOBへの書き込みを許可するBLOB Stream</li>
<li>すべてのBlob uploadおよびdownload での完全なMD5のサポート</li>
<li>Table layerでは、<a class="reference external" href="http://blogs.msdn.com/b/windowsazurestorage/archive/2013/12/05/windows-azure-tables-introducing-json.aspx">Azure Storage Table の新しいJSON サポート</a>を利用</li>
<li>Table service の、Entity Group Transaction サポート。（Entity Group Transactionでは、単一トランザクションで複数操作が可能）</li>
</ul>
</div>
<div class="section" id="read-access-geo-redundant-storage-ra-grs">
<h3>Read Access Geo Redundant Storage (RA-GRS) サポート</h3>
<p>このリリースでは、storage account のsecondary region データへの読込アクセスをフルサポートしています。　この機能は、Portalで有効にしないと利用できません、詳しくは、<a class="reference external" href="http://blogs.msdn.com/b/windowsazurestorage/archive/2013/12/11/introducing-read-access-geo-replicated-storage-ra-grs-for-windows-azure-storage.aspx">RA-GRS</a>を参照<a class="footnote-reference" href="#r3" id="id9">[3]</a>して下さい。</p>
</div>
<div class="section" id="how-to-use-it">
<h3>How to use it?</h3>
<p>NuGet package を入れると、<cite>was</cite>(Windows Azure Storageの略) のフォルダーに全てのヘッダー が入ります。  このディレクトリでは下記のheader ファイルが重要です。</p>
<ul class="simple">
<li>blob.h: Blob service 関連の全ての宣言</li>
<li>queue.h: Queue service 関連の全ての宣言</li>
<li>table.h: Table service 関連の全ての宣言</li>
<li>storage_account.h: account の name/key 、あるいは connection string から、service client のオブジェクトを簡単に作成するための cloud_storage_account type の宣言</li>
<li>retry_policies.h: 全ての操作で使われる、幾つかの retry policies の宣言</li>
</ul>
<p>下記のように使います</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span/><span class="cp">#include</span> <span class="cpf">"was/storage_account.h"</span><span class="cp"/>
<span class="cp">#include</span> <span class="cpf">"was/queue.h"</span><span class="cp"/>
<span class="cp">#include</span> <span class="cpf">"was/table.h"</span><span class="cp"/>
<span class="cp">#include</span> <span class="cpf">"was/blob.h"</span><span class="cp"/>
</pre></div>
</div>
<p>その後、我々は作成されますcloud_storage_accountコードの後半でサービス·クライアント·オブジェクトを作成するために私達を可能にするオブジェクトを、。私たちは安全な接続のために以下のHTTPSを使用しているが、アプリケーションをデバッグするときに、HTTPは非常に便利であることに注意してください。</p>
<p>その後、下記のコードでcloud_storage_account オブジェクトを作成します。 ここでは、セキュアな接続のため https を使っていますが、デバックする場合は http が非常に便利です。</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span/><span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">cloud_storage_account</span> <span class="n">storage_account</span> <span class="o">=</span> <span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">cloud_storage_account</span><span class="o">::</span><span class="n">parse</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="s">"AccountName=&lt;account_name&gt;;AccountKey=&lt;account_key&gt;;DefaultEndpointsProtocol=https"</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="blobs">
<h3>Blobs</h3>
<p>ここでは、blob container を作成し、<cite>”some text</cite>” と入ったblobを作って、それを download 、そして container 内のblobをリストします。</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span/><span class="c1">// Create a blob container</span>
<span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">cloud_blob_client</span> <span class="n">blob_client</span> <span class="o">=</span> <span class="n">storage_account</span><span class="p">.</span><span class="n">create_cloud_blob_client</span><span class="p">();</span>
<span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">cloud_blob_container</span> <span class="n">container</span> <span class="o">=</span> <span class="n">blob_client</span><span class="p">.</span><span class="n">get_container_reference</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="s">"mycontainer"</span><span class="p">));</span>
<span class="n">container</span><span class="p">.</span><span class="n">create_if_not_exists</span><span class="p">();</span>

<span class="c1">// Upload a blob</span>
<span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">cloud_block_blob</span> <span class="n">blob1</span> <span class="o">=</span> <span class="n">container</span><span class="p">.</span><span class="n">get_block_blob_reference</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="s">"myblob"</span><span class="p">));</span>
<span class="n">blob1</span><span class="p">.</span><span class="n">upload_text</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="s">"some text"</span><span class="p">));</span>

<span class="c1">// Download a blob</span>
<span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">cloud_block_blob</span> <span class="n">blob2</span> <span class="o">=</span> <span class="n">container</span><span class="p">.</span><span class="n">get_block_blob_reference</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="s">"myblob"</span><span class="p">));</span>
<span class="n">utility</span><span class="o">::</span><span class="n">string_t</span> <span class="n">text</span> <span class="o">=</span> <span class="n">blob2</span><span class="p">.</span><span class="n">download_text</span><span class="p">();</span>

<span class="c1">// List blobs</span>
<span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">blob_result_segment</span> <span class="n">blobs</span> <span class="o">=</span> <span class="n">container</span><span class="p">.</span><span class="n">list_blobs_segmented</span><span class="p">(</span><span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">blob_continuation_token</span><span class="p">());</span>
</pre></div>
</div>
</div>
<div class="section" id="tables">
<h3>Tables</h3>
<p>以下のサンプルでは、 Tableを作成し、様々な型のプロパティの組をエンティティに挿入し、最終的にはその指定したエンティティを取得します。最初の検索操作では、ポイント·クエリを実行し、特定のエンティティを取得します。一方クエリ操作では、PartitionKeyが<cite>“partition”</cite>に等しく、かつ、RowKey が、<cite>“m”</cite>より大きいすべてのエンティティを照会します。これは、結果的にinsertした全てのエンティティになります。</p>
<p>Windows Azure Tables に関する詳しい情報は、<a class="reference external" href="http://msdn.microsoft.com/en-us/library/windowsazure/dd179338.aspx">Understanding the Table Service Data Model</a>の記事と、<a class="reference external" href="http://blogs.msdn.com/b/windowsazurestorage/archive/2010/11/06/how-to-get-most-out-of-windows-azure-tables.aspx">How to get most out of Windows Azure Tables</a>の blog post を見て下さい。</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span/><span class="c1">// Create a table</span>
<span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">cloud_table_client</span> <span class="n">table_client</span> <span class="o">=</span> <span class="n">storage_account</span><span class="p">.</span><span class="n">create_cloud_table_client</span><span class="p">();</span>
<span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">cloud_table</span> <span class="n">table</span> <span class="o">=</span> <span class="n">table_client</span><span class="p">.</span><span class="n">get_table_reference</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="s">"mytable"</span><span class="p">));</span>
<span class="n">table</span><span class="p">.</span><span class="n">create_if_not_exists</span><span class="p">();</span>

<span class="c1">// Insert a table entity</span>
<span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">table_entity</span> <span class="n">entity</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="s">"partition"</span><span class="p">),</span> <span class="n">U</span><span class="p">(</span><span class="s">"row"</span><span class="p">));</span>
<span class="n">entity</span><span class="p">.</span><span class="n">properties</span><span class="p">().</span><span class="n">insert</span><span class="p">(</span><span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">table_entity</span><span class="o">::</span><span class="n">property_type</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="s">"PropertyA"</span><span class="p">),</span> <span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">table_entity_property</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="s">"some string"</span><span class="p">))));</span>
<span class="n">entity</span><span class="p">.</span><span class="n">properties</span><span class="p">().</span><span class="n">insert</span><span class="p">(</span><span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">table_entity</span><span class="o">::</span><span class="n">property_type</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="s">"PropertyB"</span><span class="p">),</span> <span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">table_entity_property</span><span class="p">(</span><span class="n">utility</span><span class="o">::</span><span class="n">datetime</span><span class="o">::</span><span class="n">utc_now</span><span class="p">())));</span>
<span class="n">entity</span><span class="p">.</span><span class="n">properties</span><span class="p">().</span><span class="n">insert</span><span class="p">(</span><span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">table_entity</span><span class="o">::</span><span class="n">property_type</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="s">"PropertyC"</span><span class="p">),</span> <span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">table_entity_property</span><span class="p">(</span><span class="n">utility</span><span class="o">::</span><span class="n">new_uuid</span><span class="p">())));</span>
<span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">table_operation</span> <span class="n">operation1</span> <span class="o">=</span> <span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">table_operation</span><span class="o">::</span><span class="n">insert_or_replace_entity</span><span class="p">(</span><span class="n">entity</span><span class="p">);</span>
<span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">table_result</span> <span class="n">table_result</span> <span class="o">=</span> <span class="n">table</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">operation1</span><span class="p">);</span>

<span class="c1">// Retrieve a table entity</span>
<span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">table_operation</span> <span class="n">operation2</span> <span class="o">=</span> <span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">table_operation</span><span class="o">::</span><span class="n">retrieve_entity</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="s">"partition"</span><span class="p">),</span> <span class="n">U</span><span class="p">(</span><span class="s">"row"</span><span class="p">));</span>
<span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">table_result</span> <span class="n">result</span> <span class="o">=</span> <span class="n">table</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">operation2</span><span class="p">);</span>

<span class="c1">// Query table entities</span>
<span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">table_query</span> <span class="n">query</span><span class="p">;</span>
<span class="n">query</span><span class="p">.</span><span class="n">set_filter_string</span><span class="p">(</span><span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">table_query</span><span class="o">::</span><span class="n">combine_filter_conditions</span><span class="p">(</span>
    <span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">table_query</span><span class="o">::</span><span class="n">generate_filter_condition</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="s">"PartitionKey"</span><span class="p">),</span> <span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">query_comparison_operator</span><span class="o">::</span><span class="n">equal</span><span class="p">,</span> <span class="n">U</span><span class="p">(</span><span class="s">"partition"</span><span class="p">)),</span> 
    <span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">query_logical_operator</span><span class="o">::</span><span class="n">and</span><span class="p">,</span> 
    <span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">table_query</span><span class="o">::</span><span class="n">generate_filter_condition</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="s">"RowKey"</span><span class="p">),</span> <span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">query_comparison_operator</span><span class="o">::</span><span class="n">greater_than_or_equal</span><span class="p">,</span> <span class="n">U</span><span class="p">(</span><span class="s">"m"</span><span class="p">))));</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">table_entity</span><span class="o">&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">table</span><span class="p">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="queues">
<h3>Queues</h3>
<p>最後の例では、Queueを作成します、それにmessageを追加、同じmessageを取得し、最終的にそれを更新します。</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span/><span class="c1">// Create a queue</span>
<span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">cloud_queue_client</span> <span class="n">queue_client</span> <span class="o">=</span> <span class="n">storage_account</span><span class="p">.</span><span class="n">create_cloud_queue_client</span><span class="p">();</span>
<span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">cloud_queue</span> <span class="n">queue</span> <span class="o">=</span> <span class="n">queue_client</span><span class="p">.</span><span class="n">get_queue_reference</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="s">"myqueue"</span><span class="p">));</span>
<span class="n">queue</span><span class="p">.</span><span class="n">create_if_not_exists</span><span class="p">();</span>

<span class="c1">// Add a queue message</span>
<span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">cloud_queue_message</span> <span class="n">message1</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="s">"mymessage"</span><span class="p">));</span>
<span class="n">queue</span><span class="p">.</span><span class="n">add_message</span><span class="p">(</span><span class="n">message1</span><span class="p">);</span>

<span class="c1">// Get a queue message</span>
<span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">cloud_queue_message</span> <span class="n">message2</span> <span class="o">=</span> <span class="n">queue</span><span class="p">.</span><span class="n">get_message</span><span class="p">();</span>

<span class="c1">// Update a queue message</span>
<span class="n">message2</span><span class="p">.</span><span class="n">set_content</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="s">"changedmessage"</span><span class="p">));</span>
<span class="n">queue</span><span class="p">.</span><span class="n">update_message</span><span class="p">(</span><span class="n">message2</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">seconds</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="nb">true</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h3>デバック方法</h3>
<p>なにか上手く行っていない場合、exception で帰ってきます。この exception は、wa::storage::storage_exception の型で、なにか問題なのかの詳細な情報を含んでいます。次のコードを見て下さい。</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span/><span class="k">try</span>
<span class="p">{</span>
    <span class="n">blob1</span><span class="p">.</span><span class="n">download_attributes</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">storage_exception</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Exception: "</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">ucout</span> <span class="o">&lt;&lt;</span> <span class="n">U</span><span class="p">(</span><span class="s">"The request that started at "</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">result</span><span class="p">().</span><span class="n">start_time</span><span class="p">().</span><span class="n">to_string</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">U</span><span class="p">(</span><span class="s">" and ended at "</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">result</span><span class="p">().</span><span class="n">end_time</span><span class="p">().</span><span class="n">to_string</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">U</span><span class="p">(</span><span class="s">" resulted in HTTP status code "</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">result</span><span class="p">().</span><span class="n">http_status_code</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">U</span><span class="p">(</span><span class="s">" and the request ID reported by the server was "</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">result</span><span class="p">().</span><span class="n">service_request_id</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>blobが存在しない場合, このコードは下記のような結果になります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span/>Exception: The specified blob does not exist.

The request that started at Fri, 13 Dec 2013 18:31:11 GMT and ended at Fri, 13 Dec 2013 18:31:11 GMT resulted in HTTP status code 404 and the request ID reported by the server was 5de65ae4-9a71-4b1d-9c99-cc4225e714c6
</pre></div>
</div>
<p>ライブラリでは、type wa::storage::operation_context を提供しています。これは、全てのAPIでサポートされ、操作中に行われていることについてより多くの情報を取得するために使います。次のコードを見て下さい。</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span/><span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">operation_context</span> <span class="n">context</span><span class="p">;</span> 

<span class="n">context</span><span class="p">.</span><span class="n">set_sending_request</span><span class="p">([]</span> <span class="p">(</span><span class="n">web</span><span class="o">::</span><span class="n">http</span><span class="o">::</span><span class="n">http_request</span><span class="o">&amp;</span> <span class="n">request</span><span class="p">,</span> <span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">operation_context</span><span class="p">)</span> 
<span class="p">{</span> 
  <span class="n">ucout</span> <span class="o">&lt;&lt;</span> <span class="n">U</span><span class="p">(</span><span class="s">"The request is being sent to "</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">request</span><span class="p">.</span><span class="n">request_uri</span><span class="p">().</span><span class="n">to_string</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> 
<span class="p">});</span>

<span class="n">context</span><span class="p">.</span><span class="n">set_response_received</span><span class="p">([]</span> <span class="p">(</span><span class="n">web</span><span class="o">::</span><span class="n">http</span><span class="o">::</span><span class="n">http_request</span><span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">web</span><span class="o">::</span><span class="n">http</span><span class="o">::</span><span class="n">http_response</span><span class="o">&amp;</span> <span class="n">response</span><span class="p">,</span> <span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">operation_context</span><span class="p">)</span> 
<span class="p">{</span> 
  <span class="n">ucout</span> <span class="o">&lt;&lt;</span> <span class="n">U</span><span class="p">(</span><span class="s">"The reason phrase is "</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">response</span><span class="p">.</span><span class="n">reason_phrase</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> 
<span class="p">});</span>

<span class="k">try</span> 
<span class="p">{</span> 
  <span class="n">blob1</span><span class="p">.</span><span class="n">download_attributes</span><span class="p">(</span><span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">access_condition</span><span class="p">(),</span> <span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">blob_request_options</span><span class="p">(),</span> <span class="n">context</span><span class="p">);</span> 
<span class="p">}</span> 
<span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="n">wa</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">storage_exception</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span> 
<span class="p">{</span> 
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Exception: "</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> 
<span class="p">}</span> 

<span class="n">ucout</span> <span class="o">&lt;&lt;</span> <span class="n">U</span><span class="p">(</span><span class="s">"Executed "</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">context</span><span class="p">.</span><span class="n">request_results</span><span class="p">().</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">U</span><span class="p">(</span><span class="s">" request(s) to perform this operation and the last request's status code was "</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">context</span><span class="p">.</span><span class="n">request_results</span><span class="p">().</span><span class="n">back</span><span class="p">().</span><span class="n">http_status_code</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</pre></div>
</div>
<p>もう一度、blobが存在しない状況で動かします。すると下記のような結果になります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span/>wa::storage::operation_context context; 

context.set_sending_request([] (web::http::http_request&amp; request, wa::storage::operation_context) 
{ 
  ucout &lt;&lt; U("The request is being sent to ") &lt;&lt; request.request_uri().to_string() &lt;&lt; std::endl; 
});

context.set_response_received([] (web::http::http_request&amp;, const web::http::http_response&amp; response, wa::storage::operation_context) 
{ 
  ucout &lt;&lt; U("The reason phrase is ") &lt;&lt; response.reason_phrase() &lt;&lt; std::endl; 
});

try 
{ 
  blob1.download_attributes(wa::storage::access_condition(), wa::storage::blob_request_options(), context); 
} 
catch (const wa::storage::storage_exception&amp; e) 
{ 
  std::cout &lt;&lt; "Exception: " &lt;&lt; e.what() &lt;&lt; std::endl; 
} 

ucout &lt;&lt; U("Executed ") &lt;&lt; context.request_results().size() &lt;&lt; U(" request(s) to perform this operation and the last request's status code was ") &lt;&lt; context.request_results().back().http_status_code() &lt;&lt; std::endl;
</pre></div>
</div>
</div>
<div class="section" id="samples">
<h3>Samples</h3>
<p><a class="reference external" href="https://github.com/WindowsAzure/azure-storage-cpp/tree/master/Microsoft.WindowsAzure.Storage/samples">github 上のプロジェクトのサンプル</a>フォルダの中に、幾つかの重要なシナリを説明する コードがあります。</p>
<p>Visual Studioで「Microsoft.WindowsAzure.Storage.Samples.sln」という名前のサンプルのソリューションファイルを開きます。Microsoft.WindowsAzure.Storage.SamplesCommonプロジェクトの下samples_common.hファイルの、ストレージのアカウント情報を更新します。Solution Explorer のウィンドウに移動し、（例えば、Microsoft.WindowsAzure.Storage.BlobsGettingStarted）実行したいサンプルプロジェクトを選択してStartUp Projectにするか、コンテキストメニューから実行します。</p>
</div>
<div class="section" id="summary">
<h3>Summary</h3>
<p><a class="reference external" href="http://blogs.msdn.com/b/windowsazurestorage/archive/2013/12/20/windows-azure-storage-client-library-for-cplusplus-preview.aspx">コメント欄 （原文）</a>、フォーラム、あるいは<a class="reference external" href="https://github.com/WindowsAzure/azure-storage-cpp">GitHub</a>でのフィードバックをお待ちしています。BUGに当たった場合、GitHubに上げてもらえると、その後の解決策などをトラックすることができるようになります。</p>
<p>Serdar Ozler, Mike Fisher, and Joe Giardino</p>
</div>
<div class="section" id="resources">
<h3>Resources</h3>
<div class="line-block">
<div class="line"><a class="reference external" href="https://github.com/WindowsAzure/azure-storage-cpp">Source (GitHub)</a></div>
<div class="line"><a class="reference external" href="http://www.nuget.org/packages/wastorage">Binaries (NuGet)</a></div>
<div class="line"><a class="reference external" href="http://blogs.msdn.com/b/windowsazurestorage/archive/2013/11/27/windows-azure-storage-release-introducing-cors-json-minute-metrics-and-more.aspx">Windows Azure Storage Release - Introducing CORS, JSON, Minute Metrics, and More</a></div>
<div class="line"><a class="reference external" href="http://blogs.msdn.com/b/windowsazurestorage/archive/2013/12/05/windows-azure-tables-introducing-json.aspx">Windows Azure Tables: Introducing JSON</a></div>
</div>
</div>
</div>
<div class="section" id="id14">
<h2>まとめ</h2>
<p>C++用のクライアントは良いですね、やっぱり欲しい。</p>
<p>その他に、今回<a class="reference external" href="http://coapp.org/">CoApp tools</a>が気になりました。native code をnugetでpackege化して配布するプロジェクトです。 Windows にapt-getみたいな位置づけに機能を盛り込むのを狙っているようで、期待できます。<a class="footnote-reference" href="#r4" id="id16">[4]</a>これで、python、ruby、node.js で Windows パッケージのバイナリコードのビルドに引っかかる問題も、このレポジトリを参照することで解決できると良いなあと思いますが、今のところプロジェクトのターゲットに入っていないようで、そこはちょっと残念です。</p>
<p>もう一つ、<a class="reference external" href="http://casablanca.codeplex.com/">http://casablanca.codeplex.com/</a>は、<a class="reference external" href="http://msdn.microsoft.com/library/jj969455(v=vs.120).aspx">MSDN C++ REST SDK (Codename “Casablanca”)</a>に割りとしっかりしたドキュメントが上がっていて、nugetでは、production 扱いなので、使っても良さそうな感じです。<a class="reference external" href="http://www.nuget.org/packages/cpprestsdk/">C++ REST SDK 1.4.0</a>今年の４月からパッケージとしては上がっていたようですが、気が付きませんでした。</p>
<p>nugetを見てみたところ、C++ REST SDK も、SDK、 Redist、Symbols の３本立てになってました。でも、SDKが1.4.0なのに他が1.3.1のままですね。</p>
<ul class="simple">
<li><a class="reference external" href="http://www.nuget.org/packages/cpprestsdk/">C++ REST SDK 1.4.0</a></li>
<li><a class="reference external" href="http://www.nuget.org/packages/cpprestsdk.redist/">C++ REST SDK Redist 1.3.1</a></li>
<li><a class="reference external" href="http://www.nuget.org/packages/cpprestsdk.symbols/">C++ REST SDK Symbols 1.3.1</a></li>
</ul>
<p>パッケージマネージャー関連は、nuget を中心に、整備が進んでいるようで、いろいろ期待できますね。</p>
<div class="line-block">
<div class="line"><br/></div>
<div class="line"><br/></div>
</div>
<table class="docutils footnote" frame="void" id="r1" rules="none">
<colgroup><col class="label"/><col/></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[1]</a></td><td>日本語訳<a class="reference external" href="http://download.microsoft.com/download/C/0/2/C02C4D26-0472-4688-AC13-199EA321135E/23rdACM_SOSP_WindowsAzureStorage_201110_jpn.pdf">SOSP 論文 Windows Azure ストレージ: 高可用性と強い一貫を両立する クラウド ストレージ サービス</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="r2" rules="none">
<colgroup><col class="label"/><col/></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[2]</a></td><td><a class="reference external" href="http://blogs.msdn.com/b/windowsazurestorage/archive/2013/12/19/windows-azure-storage-client-library-for-java-v-0-5-0.aspx">Windows Azure Storage Client Library for Java v. 0.5.0</a>では、<cite>An updated Windows Azure Storage Emulator is expected to ship with full support of these new features in the next couple of months.</cite>になっていました。数ヶ月先って話だったので、来月だとすると良い知らせですね。</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="r3" rules="none">
<colgroup><col class="label"/><col/></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[3]</a></td><td>日本語訳<a class="reference external" href="http://blogs.msdn.com/b/windowsazurej/archive/2013/12/19/blog-windows-azure-storage-redundancy-options-and-read-access-geo-redundant-storage.aspx">Windows Azure ストレージの冗長オプションと読み取りアクセス地理冗長ストレージ</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="r4" rules="none">
<colgroup><col class="label"/><col/></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id16">[4]</a></td><td><a class="reference external" href="http://coapp.org/news/2013-10-02-State-of-CoApp.html">The State of CoApp</a></td></tr>
</tbody>
</table>
</div>

        </div>
        <div class="postmeta">
        <div class="author">
            <span>Posted by Takekazu Omi</span>
        </div>
        <div class="categories">
            <span>
                Filed under:
                <a href="categories/azure.html">Azure</a>, <a href="categories/azure_sdk.html">Azure SDK</a>, <a href="categories/azure_storage.html">Azure Storage</a></span>
        </div>
        <div class="tags">
            <span>
                Tags:
                <a href="tags/2013_08_15.html">2013-08-15</a>, <a href="tags/azure.html">Azure</a>, <a href="tags/c.html">C++</a>, <a href="tags/release.html">Release</a>, <a href="tags/azure_storage.html">Azure Storage</a></span>
        </div>
        <div class="comments">
            <a href="http://kyrt.in/2013/12/21/windows_azure_storage_client_library_for_c_preview.html#disqus_thread" data-disqus-identifier="2013/12/21/windows_azure_storage_client_library_for_c_preview">Leave a comment</a>
        </div></div><div class="separator post_separator"></div><div class="timestamp postmeta">
            <span>December 20, 2013</span>
        </div>
        <div class="section">
            <h1><a href="2013/12/20/windows_azure_storage_client_library_for_java_v_0_5_0.html">Windows Azure Storage Client Library for Java v. 0.5.0</a></h1>
<p><a class="reference external" href="http://blogs.msdn.com/b/windowsazurestorage/archive/2013/12/19/windows-azure-storage-client-library-for-java-v-0-5-0.aspx">Windows Azure Storage Client Library for Java v. 0.5.0 がリリースされました</a></p>
<blockquote>
<div><div class="line-block">
<div class="line">2013/12/27  Windows Azure Japan Team Blog 公式 谷訳出ました。 <a class="reference external" href="http://blogs.msdn.com/b/windowsazurej/archive/2013/12/27/blog-windows-azure-storage-client-library-for-java-v-0-5-0.aspx">Java v. 0.5.0 用 Windows Azure ストレージ クライアント ライブラリ</a></div>
</div>
</div></blockquote>
<p>以下にざっくりと訳します。</p>
<div class="section" id="windows-azure-storage-team-blog-windows-azure-storage-client-library-for-java-v-0-5-0">
<h2>抄訳 Windows Azure Storage Team Blog - Windows Azure Storage Client Library for Java v. 0.5.0</h2>
<p>このリリースでは、logging support, 新しい API overloads、そして 2013-08-15 REST<a class="footnote-reference" href="#r1" id="id2">[1]</a>が完全にサポートされています。今までのようにソースコードは、<a class="reference external" href="https://github.com/WindowsAzure/azure-storage-java">github Windows Azure Storage libraries for Java</a>で公開されています。<a class="footnote-reference" href="#r2" id="id3">[2]</a>従来のようにmaven のレポジトリに登録されています。</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span/><span class="nt">&lt;dependency&gt;</span>  
     <span class="nt">&lt;groupId&gt;</span>com.microsoft.windowsazure.storage<span class="nt">&lt;/groupId&gt;</span>
     <span class="nt">&lt;artifactId&gt;</span>microsoft-windowsazure-storage-sdk<span class="nt">&lt;/artifactId&gt;</span>
     <span class="nt">&lt;version&gt;</span>0.5.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<div class="section" id="id4">
<h3>エミュレータ ガイダンス</h3>
<p>現在のAzure SDK(2.2)のエミュレータは、<a class="reference external" href="http://msdn.microsoft.com/en-us/library/windowsazure/dd894041.aspx">2013-08-15 REST</a>をサポートしていません。今後数ヶ月以内にサポートしたものを出す予定です。</p>
</div>
<div class="section" id="samples">
<h3>Samples</h3>
<p><a class="reference external" href="https://github.com/WindowsAzure/azure-storage-java">github</a>のソースのなかに、幾つかの重要なシナリを説明する<a class="reference external" href="http://blogs.msdn.com/b/windowsazurestorage/archive/2013/12/19/windows-azure-storage-client-library-for-java-v-0-5-0.aspx">サンプル</a>があります。指定されたサンプルを実行するには、サンプルプロジェクトをロードし、ストレージの資格情報を提供するために、Utility.javaの次の行を更新します。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span/><span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">storageConnectionString</span> <span class="o">=</span> <span class="s">"DefaultEndpointsProtocol=http;AccountName=[ACCOUNT_NAME];AccountKey=[ACCOUNT_KEY]"</span><span class="p">;</span>
</pre></div>
</div>
<p>fiddler を使ってサンプル実行中の traffic を見たい場合は、Utility.java の下記の2行をコメントアウトを外してください。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span/><span class="c1">// System.setProperty("http.proxyHost", "localhost");</span>
<span class="c1">// System.setProperty("http.proxyPort", "8888");</span>
</pre></div>
</div>
</div>
<div class="section" id="note-about-packaging-and-versioning">
<h3>Note about Packaging and Versioning</h3>
<p>このリリースで、大きな Windows Azure SDK for Java から、ストレージパッケージを独立させました。現在、既存のSDKを活用している開発者は、それに応じて依存関係を更新する必要があります。さらに、パッケージ名は、この新しい構造を反映するように変更されました：</p>
<ul class="simple">
<li>com.microsoft.windowsazure.storage - RetryPolicies、LocationMode、StorageException、StorageAccountなどサービス間で共通しているすべてのpublicクラス</li>
<li>com.microsoft.windowsazure.storage.blob -  Blob convenience implementation、Windows Azure Blobを利用しているアプリケーションは、importしてください。</li>
<li>com.microsoft.windowsazure.storage.queue - Queue convenience implementation、Windows Azure Queueを利用するアプリケーションは、importしてください。</li>
<li>com.microsoft.windowsazure.storage.table - Table convenience implementation、Windows Azure Tableを利用しているアプリケーションは、importしてください。</li>
</ul>
<p>さらに詳しい情報は、以下の Change Log &amp; Breaking Changes  のセクションを見て下さい。</p>
<p>また、Storage Client SDK componentでは、<a class="reference external" href="http://semver.org/">Semantic Versioning</a>を採用します。これは、SDKを活用する開発者に一貫した予測可能なバージョン管理指針を提供するのに役立ちます。</p>
</div>
</div>
<div class="section" id="whats-new">
<h2>Whats New</h2>
<p>Java client library の 0.5.0 では、2013-08-15 REST service version の全ての機能<a class="footnote-reference" href="#r1" id="id6">[1]</a>をサポートします。</p>
<div class="section" id="support-for-read-access-geo-redundant-storage">
<h3>Support for Read Access Geo Redundant Storage</h3>
<p>このリリースでは、secondary region の storage account data の読み取りアクセス (RA-GRS)<a class="footnote-reference" href="#r3" id="id7">[3]</a>を完全にサポートしています。クライアントオブジェクト上の位置モードを設定し、getServiceStatsを起動すると、以下の例に示されている。LocationModeもRequestOptionsオブジェクト上に設定することで、リクエストごとに設定することができます。</p>
<p>下記の例では、client objectの location mode を設定して getServiceStats を呼び出すことで、 replication の状態を取得しています。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span/><span class="n">CloudStorageAccount</span> <span class="n">httpAcc</span> <span class="o">=</span> <span class="n">CloudStorageAccount</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">connectionString</span><span class="p">);</span>
<span class="n">CloudTableClient</span> <span class="n">tClient</span> <span class="o">=</span> <span class="n">httpAcc</span><span class="p">.</span><span class="na">createCloudTableClient</span><span class="p">();</span>

<span class="c1">// Set the LocationMode to SECONDARY_ONLY since getServiceStats is supported only on the secondary endpoints.</span>
<span class="n">tClient</span><span class="p">.</span><span class="na">setLocationMode</span><span class="p">(</span><span class="n">LocationMode</span><span class="p">.</span><span class="na">SECONDARY_ONLY</span><span class="p">);</span>
<span class="n">ServiceStats</span> <span class="n">stats</span> <span class="o">=</span> <span class="n">tClient</span><span class="p">.</span><span class="na">getServiceStats</span><span class="p">();</span>
<span class="n">Date</span> <span class="n">lastSyncTime</span> <span class="o">=</span> <span class="n">stats</span><span class="p">.</span><span class="na">getGeoReplication</span><span class="p">().</span><span class="na">getLastSyncTime</span><span class="p">();</span>

<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">"Replication status = %s and LastSyncTime = %s"</span><span class="p">,</span><span class="n">stats</span><span class="p">.</span><span class="na">getGeoReplication</span><span class="p">().</span><span class="na">getStatus</span><span class="p">().</span><span class="na">toString</span><span class="p">(),</span> <span class="n">lastSyncTime</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">lastSyncTime</span><span class="p">.</span><span class="na">toString</span><span class="p">():</span> <span class="s">"empty"</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="expanded-table-protocol-support-json">
<h3>Expanded Table Protocol Support (JSON)</h3>
<blockquote>
<div>table traffic で、JSONがサポートされました。TableClient の setTablePayloadFormat() で、TablePayloadFormatを指定することでJSONformatを使うことができます。</div></blockquote>
<div class="highlight-java notranslate"><div class="highlight"><pre><span/><span class="n">CloudStorageAccount</span> <span class="n">httpAcc</span> <span class="o">=</span> <span class="n">CloudStorageAccount</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">connectionString</span><span class="p">);</span>
<span class="n">CloudTableClient</span> <span class="n">tableClient</span> <span class="o">=</span> <span class="n">httpAcc</span><span class="p">.</span><span class="na">createCloudTableClient</span><span class="p">();</span>

<span class="c1">// Set the payload format to JsonNoMetadata.</span>
<span class="n">tableClient</span><span class="p">.</span><span class="na">setTablePayloadFormat</span><span class="p">(</span><span class="n">TablePayloadFormat</span><span class="p">.</span><span class="na">JsonNoMetadata</span><span class="p">);</span>
</pre></div>
</div>
<p>JsonNoMetadataを指定した場合メタデータがpayloadに有りません、その場合プロパティの型はpropertyResolver を用意して下記のようにコードで解釈します。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span/><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Class1</span> <span class="kd">extends</span> <span class="n">TableServiceEntity</span> <span class="kd">implements</span> <span class="n">PropertyResolver</span> <span class="p">{</span>    
    <span class="kd">private</span> <span class="n">String</span> <span class="n">A</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">B</span><span class="p">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getA</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">A</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getB</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">B</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setA</span><span class="p">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">this</span><span class="p">.</span><span class="na">A</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setB</span><span class="p">(</span><span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">this</span><span class="p">.</span><span class="na">B</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">EdmType</span> <span class="nf">propertyResolver</span><span class="p">(</span><span class="n">String</span> <span class="n">pk</span><span class="p">,</span> <span class="n">String</span> <span class="n">rk</span><span class="p">,</span> <span class="n">String</span> <span class="n">key</span><span class="p">,</span> <span class="n">String</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">"A"</span><span class="p">))</span> <span class="p">{</span>
	    <span class="k">return</span> <span class="n">EdmType</span><span class="p">.</span><span class="na">STRING</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">"B"</span><span class="p">))</span> <span class="p">{</span>
	    <span class="k">return</span> <span class="n">EdmType</span><span class="p">.</span><span class="na">BINARY</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
    
<span class="p">}</span>
</pre></div>
</div>
<p>この、propertyResolver は、TableRequestOptions にセットします。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span/><span class="n">Class1</span> <span class="n">ref</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Class1</span><span class="p">();</span>
<span class="n">ref</span><span class="p">.</span><span class="na">setA</span><span class="p">(</span><span class="s">"myPropVal"</span><span class="p">);</span>
<span class="n">ref</span><span class="p">.</span><span class="na">setB</span><span class="p">(</span><span class="k">new</span> <span class="kt">byte</span><span class="o">[]</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">});</span>
<span class="n">ref</span><span class="p">.</span><span class="na">setPartitionKey</span><span class="p">(</span><span class="s">"testKey"</span><span class="p">);</span>
<span class="n">ref</span><span class="p">.</span><span class="na">setRowKey</span><span class="p">(</span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">());</span>

<span class="n">options</span><span class="p">.</span><span class="na">setPropertyResolver</span><span class="p">(</span><span class="n">ref</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="table-insert-optimizations">
<h3>Table Insert Optimizations</h3>
<p>以前のバージョンでは、Table Insertのレスポンスでentity全体が返されていましたが、このバージョンから inserts が成功したときは 204 (no-content) でbodyは空がかえるようになりました。従来と同じように動作させるには、insert(TableEntity, boolean) method に true を指定します。</p>
</div>
<div class="section" id="table-reflection-optimizations">
<h3>Table Reflection Optimizations</h3>
<p>clients が、POJOを永続化するときに、繰り返しの reflection calls を無くすために、type や property information をcacheするようにしました。この最適化の結果劇的にCPU時間が削減されます。このCache機能を無効にするには、TableServiceEntity.setReflectedEntityCacheDisabled(true) を使って下さい。</p>
</div>
<div class="section" id="new-apis-and-overloads">
<h3>New APIs and overloads</h3>
<p>customer feedback から下記のAPIを追加しました、</p>
<ul class="simple">
<li>CloudBlob.downloadRange</li>
<li>CloudBlob.downloadToByteArray</li>
<li>CloudBlob.downloadRangeToByteArray</li>
<li>CloudBlob.uploadFromByteArray</li>
<li>CloudBlob.uploadFromByteArray</li>
<li>CloudBlob.downloadToFile</li>
<li>CloudBlob.uploadFromFile</li>
<li>CloudBlockBlob.uploadText</li>
<li>CloudBlockBlob.downloadText</li>
</ul>
</div>
<div class="section" id="logging">
<h3>Logging</h3>
<p>0.5.0 リリースでは、<a class="reference external" href="http://www.slf4j.org/">SLF4J</a>logging facade をサポートしています。</p>
<p>詳細省略</p>
</div>
</div>
<div class="section" id="change-log-breaking-changes">
<h2>Change Log &amp; Breaking Changes</h2>
<p>このリリースには、 2013-08-15 REST<a class="footnote-reference" href="#r1" id="id8">[1]</a>のサポート以外にも幾つかの重要な変更があります。要点を下記にまとめます。</p>
<div class="section" id="common">
<h3>Common</h3>
<ul class="simple">
<li>Package の再構築</li>
<li>RetryResultが追加機能を提供しRetryInfoに置き換えられています</li>
<li>request中に起きるevent operations (event firingを含む) は、同期では無くなりました。 (thread safety は、event listenersのCopyOnWriteArrayList で保証されます)</li>
<li>OperationContext.sendingRequest eventは、 headerを変更することができるように connection が established されるまえに fireされます</li>
</ul>
</div>
<div class="section" id="blob">
<h3>Blob</h3>
<ul class="simple">
<li>BlobdownloadRangeはStreamにダウンロードします。以前のdownloadRangeはdownloadRangeToByteArrayに変更されました</li>
<li>sparse page blob feature は削除されました</li>
<li>CloudBlobContainer.createIfNotExistはCloudBlobContainer.createIfNotExistに改名されました</li>
<li>CloudBlobClient.streamMinimumReadSizeInBytesは削除されました。この機能は、はCloudBlob.streamMinimumReadSizeInBytesで提供さえます（これは、Client毎のではなくBlob毎の設定です）</li>
<li>CloudBlobClient.pageBlobStreamWriteSizeInBytesとCloudBlobClient.writeBlockSizeInBytesは削除されました。この機能は、CloudBlob.streamWriteSizeInBytesで提供されます</li>
</ul>
</div>
<div class="section" id="table">
<h3>Table</h3>
<ul class="simple">
<li>TableResultから id field が削除されました（getId、setIdも）</li>
<li>CloudTable.createIfNotExistはCloudTable.createIfNotExistに名前が変更されました</li>
<li>Insert 操作はcontents echoをしません。</li>
<li>デフォルトのPayload形式は、JsonMinimalMetadataになりました。CloudTableClient.setTablePayloadFormatで全てのリクエスト、あるいは個々のリクエストでTableRequestOptions.setTablePayloadFormatを使ってpayload formatを変更することができます</li>
</ul>
</div>
<div class="section" id="queue">
<h3>Queue</h3>
<ul class="simple">
<li>CloudQueue.createIfNotExistはCloudQueue.createIfNotExistに名前が変更されました</li>
</ul>
</div>
</div>
<div class="section" id="resources">
<h2>Resources</h2>
<p><a class="reference external" href="https://github.com/WindowsAzure/azure-storage-java">Source (github)</a></p>
<p><a class="reference external" href="http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22com.microsoft.windowsazure.storage%22">Maven</a></p>
<p><a class="reference external" href="https://github.com/WindowsAzure/azure-storage-java/blob/master/BreakingChanges.txt">BreakingChanges</a></p>
<p><a class="reference external" href="https://github.com/WindowsAzure/azure-storage-java/blob/master/ChangeLog.txt">ChangeLog</a></p>
<p><a class="reference external" href="http://blogs.msdn.com/b/windowsazurestorage/archive/2013/11/27/windows-azure-storage-release-introducing-cors-json-minute-metrics-and-more.aspx">Windows Azure Storage Release - Introducing CORS, JSON, Minute Metrics, and More</a></p>
<p><a class="reference external" href="http://blogs.msdn.com/b/windowsazurestorage/archive/2013/12/05/windows-azure-tables-introducing-json.aspx">Windows Azure Tables: Introducing JSON</a></p>
<p><a class="reference external" href="http://blogs.msdn.com/b/windowsazurestorage/archive/2013/12/11/introducing-read-access-geo-replicated-storage-ra-grs-for-windows-azure-storage.aspx">Windows Azure Storage Redundancy Options and Read Access Geo Redundant Storage</a></p>
<p><a class="reference external" href="http://semver.org/">SemVer Specification</a></p>
</div>
<div class="section" id="id9">
<h2>最後に</h2>
<p>0.4 にあった、<a class="reference internal" href="2013/10/17/azure_java_sdk_long_value_filtering_bug.html"><span class="doc">Azure SDK for Java 0.4.6 long値のfilter BUG</span></a>は無事改修されているようです。<a class="reference external" href="https://github.com/WindowsAzure/azure-storage-java/commit/834daae4e23b51e16e65e5bbf13096075d1f47ca#diff-f8d410db4741b0e56a8050948b11115c">https://github.com/WindowsAzure/azure-storage-java/commit/834daae4e23b51e16e65e5bbf13096075d1f47ca#diff-f8d410db4741b0e56a8050948b11115c</a></p>
<div class="line-block">
<div class="line">互換性の問題などから、0.4を使い続ける場合は引き続き注意が必要です。</div>
</div>
<div class="line-block">
<div class="line"><br/></div>
<div class="line"><br/></div>
</div>
<table class="docutils footnote" frame="void" id="r1" rules="none">
<colgroup><col class="label"/><col/></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id2">1</a>, <a class="fn-backref" href="#id6">2</a>, <a class="fn-backref" href="#id8">3</a>)</em> version 2013-08-15 storage<a class="reference external" href="http://blogs.msdn.com/b/windowsazurestorage/archive/2013/11/27/windows-azure-storage-release-introducing-cors-json-minute-metrics-and-more.aspx">英語</a><a class="reference external" href="http://blogs.msdn.com/b/windowsazurej/archive/2013/12/03/blog-windows-azure-storage-release-introducing-cors-json-minute-metrics-and-more.aspx">日本語</a><a class="reference external" href="http://satonaoki.wordpress.com/2013/11/30/azure-storage-cors-json-metric/">SATO NAOKI訳</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="r2" rules="none">
<colgroup><col class="label"/><col/></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[2]</a></td><td>0.4 までは、<a class="reference external" href="https://github.com/WindowsAzure/azure-sdk-for-java">azure-sdk-for-java</a>だったのですが、レポジトリが変わり。 0.5からは、<a class="reference external" href="https://github.com/WindowsAzure/azure-storage-java">azure-storage-java</a>になりました。.NETのStorage Clientと同じような名前変更がされたようです。</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="r3" rules="none">
<colgroup><col class="label"/><col/></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[3]</a></td><td><a class="reference external" href="http://blogs.msdn.com/b/windowsazurej/archive/2013/12/19/blog-windows-azure-storage-redundancy-options-and-read-access-geo-redundant-storage.aspx">Windows Azure ストレージの冗長オプションと読み取りアクセス地理冗長ストレージ</a></td></tr>
</tbody>
</table>
</div>

        </div>
        <div class="postmeta">
        
        <div class="categories">
            <span>
                Filed under:
                <a href="categories/azure.html">Azure</a>, <a href="categories/azure_sdk.html">Azure SDK</a>, <a href="categories/azure_storage.html">Azure Storage</a></span>
        </div>
        <div class="tags">
            <span>
                Tags:
                <a href="tags/2013_08_15.html">2013-08-15</a>, <a href="tags/azure.html">Azure</a>, <a href="tags/java.html">Java</a>, <a href="tags/release.html">Release</a>, <a href="tags/azure_storage.html">Azure Storage</a></span>
        </div>
        <div class="comments">
            <a href="http://kyrt.in/2013/12/20/windows_azure_storage_client_library_for_java_v_0_5_0.html#disqus_thread" data-disqus-identifier="2013/12/20/windows_azure_storage_client_library_for_java_v_0_5_0">Leave a comment</a>
        </div></div><div class="archive_link">
        <a href="archive.html"> &mdash; Blog Archive &mdash; </a>
    </div><ul class="related clearfix">
            <li class="left"> &laquo; <a href="page8.html">Newer</a></li>
            <li class="right"><a href="page10.html">Older</a> &raquo; </li>
        </ul></article><aside class="sidebar"><section><div class="widget">
    <h1>Recent Posts</h1>
    <ul><li>
            <a href="2020/10/27/bicep_devcontaner.html">bicep 用 dev contaner</a>
        </li><li>
            <a href="2020/10/18/bicep_module.html">bicep moduleを使う</a>
        </li><li>
            <a href="2020/09/27/azure-docker-integration.html">Azure Docker Integration</a>
        </li><li>
            <a href="2017/12/02/cross_subscription_deployment.html">複数Subscriptionへのデプロイ</a>
        </li><li>
            <a href="2017/07/02/2017_mvp.html">2017 Microsoft MVP Award を受賞しました</a>
        </li><li>
            <a href="2017/06/03/az_login_device_flow.html">Azure に OAuth 2.0 Device Flow でログインする</a>
        </li><li>
            <a href="2017/05/19/install_azure_powershell.html">Azure PowerShellのインストール事情</a>
        </li><li>
            <a href="2017/05/14/azure_cosmos_intro.html">Azure Cosmos DB がやってきた</a>
        </li><li>
            <a href="2017/02/13/psenv_tabexpansion.html">PsEnv への TabExpansion の実装</a>
        </li><li>
            <a href="2017/02/10/managed_disk_1.html">Azure Managed Disk が GA</a>
        </li></ul>
</div>
</section><section><div class="widget">
    <h1>Categories</h1>
    <ul><li><a href="categories/arm_template.html">ARM template</a> (1)</li><li><a href="categories/azure.html">Azure</a> (36)</li><li><a href="categories/azure_blob.html">Azure Blob</a> (2)</li><li><a href="categories/azure_powershell.html">Azure PowerShell</a> (3)</li><li><a href="categories/azure_sdk.html">Azure SDK</a> (7)</li><li><a href="categories/azure_storage.html">Azure Storage</a> (15)</li><li><a href="categories/azure_table.html">Azure Table</a> (10)</li><li><a href="categories/batch.html">Batch</a> (1)</li><li><a href="categories/bicep.html">bicep</a> (1)</li><li><a href="categories/blog.html">blog</a> (1)</li><li><a href="categories/cdp.html">CDP</a> (1)</li><li><a href="categories/cosmos_db.html">Cosmos DB</a> (1)</li><li><a href="categories/datafactory.html">DataFactory</a> (1)</li><li><a href="categories/github観察記.html">GitHub観察記</a> (7)</li><li><a href="categories/helios.html">Helios</a> (1)</li><li><a href="categories/java.html">Java</a> (2)</li><li><a href="categories/mvp.html">MVP</a> (3)</li><li><a href="categories/owin.html">OWIN</a> (2)</li><li><a href="categories/posh.html">Posh</a> (1)</li><li><a href="categories/powershell.html">PowerShell</a> (3)</li><li><a href="categories/ruby.html">Ruby</a> (1)</li><li><a href="categories/service_fabric.html">Service Fabric</a> (2)</li><li><a href="categories/session.html">Session</a> (1)</li><li><a href="categories/storage.html">Storage</a> (1)</li><li><a href="categories/websites.html">WebSites</a> (1)</li></ul>
</div></section><section><div class="widget">
    <h1>Tags</h1><a href="tags/2013_08_15.html">2013-08-15</a> (6), <a href="tags/aci.html">ACI</a> (1), <a href="tags/architecture.html">Architecture</a> (1), <a href="tags/arm_template.html">ARM Template</a> (1), <a href="tags/async.html">Async</a> (5), <a href="tags/azure.html">Azure</a> (14), <a href="tags/azure_blob.html">Azure Blob</a> (3), <a href="tags/azure_cache.html">Azure Cache</a> (1), <a href="tags/azure_powershell.html">Azure PowerShell</a> (2), <a href="tags/azure_sdk.html">Azure SDK</a> (2), <a href="tags/azure_sdk_for_java.html">Azure SDK for Java</a> (1), <a href="tags/azure_storage.html">Azure Storage</a> (2), <a href="tags/azure_table.html">Azure Table</a> (11), <a href="tags/batch.html">Batch</a> (1), <a href="tags/bicep.html">bicep</a> (1), <a href="tags/blob.html">Blob</a> (5), <a href="tags/bug.html">BUG</a> (2), <a href="tags/bugs.html">Bugs</a> (1), <a href="tags/build2016.html">BUILD2016</a> (1), <a href="tags/build2017.html">Build2017</a> (1), <a href="tags/c.html">C#</a> (4), <a href="tags/c.html">C++</a> (1), <a href="tags/cache.html">Cache</a> (1), <a href="tags/cloud.html">Cloud</a> (5), <a href="tags/cloud_service.html">Cloud Service</a> (1), <a href="tags/code.html">Code</a> (1), <a href="tags/cool_storage.html">Cool Storage</a> (1), <a href="tags/debug.html">Debug</a> (1), <a href="tags/deploy.html">Deploy</a> (1), <a href="tags/diagonestics.html">Diagonestics</a> (2), <a href="tags/dml.html">DML</a> (2), <a href="tags/docker.html">docker</a> (1), <a href="tags/eclipse.html">Eclipse</a> (1), <a href="tags/emulator.html">Emulator</a> (2), <a href="tags/fiddler.html">Fiddler</a> (1), <a href="tags/fixed.html">Fixed</a> (1), <a href="tags/git.html">Git</a> (1), <a href="tags/goazure.html">GoAzure</a> (2), <a href="tags/gradle.html">Gradle</a> (1), <a href="tags/hotfix.html">Hotfix</a> (3), <a href="tags/how_to.html">How-to</a> (1), <a href="tags/iaas.html">IaaS</a> (1), <a href="tags/install.html">Install</a> (1), <a href="tags/intro.html">Intro</a> (1), <a href="tags/issue.html">Issue</a> (3), <a href="tags/java.html">Java</a> (3), <a href="tags/jazug.html">JAZUG</a> (1), <a href="tags/json.html">JSON</a> (1), <a href="tags/kudu.html">Kudu</a> (1), <a href="tags/manageddisk.html">ManagedDisk</a> (1), <a href="tags/nlog.html">NLog</a> (1), <a href="tags/nosql.html">NoSQL</a> (4), <a href="tags/owin.html">OWIN</a> (2), <a href="tags/play_framework.html">Play Framework</a> (1), <a href="tags/posh.html">posh</a> (2), <a href="tags/posh.html">Posh</a> (1), <a href="tags/powershell.html">PowerShell</a> (3), <a href="tags/premiumtable.html">PremiumTable</a> (1), <a href="tags/preview.html">preview</a> (1), <a href="tags/queue.html">Queue</a> (1), <a href="tags/release.html">Release</a> (4), <a href="tags/sdk.html">SDK</a> (1), <a href="tags/session.html">Session</a> (2), <a href="tags/snowflake.html">snowflake</a> (1), <a href="tags/step_by_step.html">Step By Step</a> (2), <a href="tags/storage.html">Storage</a> (15), <a href="tags/table.html">Table</a> (12), <a href="tags/translate_selected_passages.html">Translate Selected Passages</a> (3), <a href="tags/tutorial.html">Tutorial</a> (1), <a href="tags/webrole.html">WebRole</a> (1), <a href="tags/websites.html">WebSites</a> (1)</div></section><section><div class="widget" id="searchbox" role="search">
    <h1><a href="#searchbox">Search</a></h1>
    <form action="search.html" method="get">
        <input type="text" name="q" />
        <button type="submit"><span class="fa fa-search"></span></button>
    </form>
</div></section></aside></div> <!-- #main --></div> <!-- #main-container -->

        <div class="footer-container" role="contentinfo"><footer class="wrapper">&copy; Copyright 2012-2017, Takekazu Omi. Powered by <a href="http://www.tinkerer.me/">Tinkerer</a> and <a href="http://sphinx.pocoo.org/">Sphinx</a>.</footer></div> <!-- footer-container -->

      </div> <!--! end of #container --><script type="text/javascript">    var disqus_shortname = "cloudmemo";    disqus_count();</script><!--[if lt IE 7 ]>
          <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
          <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
        <![endif]-->
    </body>
</html>